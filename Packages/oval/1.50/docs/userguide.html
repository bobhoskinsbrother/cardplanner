<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>OVal - the object validation framework for Java&#8482; 5 or later</title><link rel="stylesheet" href="css/userguide.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.73.2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d4e1"></a>OVal - the object validation framework for
  <span class="trademark">Java</span>&#8482; 5 or later</h2></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d4e4">1. What is OVal?</a></span></dt><dt><span class="section"><a href="#d4e43">2. Dependencies</a></span></dt><dt><span class="section"><a href="#d4e71">3. Using OVal for property validation</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e73">3.1. Declaring constraints for class fields</a></span></dt><dt><span class="section"><a href="#d4e83">3.2. Declaring constraints for getter methods' return value</a></span></dt><dt><span class="section"><a href="#d4e93">3.3. Declaring conditional constraints using expression
      languages</a></span></dt><dt><span class="section"><a href="#d4e137">3.4. Declaring activation rules for constraints</a></span></dt><dt><span class="section"><a href="#d4e149">3.5. Interpreting EJB3 JPA annotations</a></span></dt><dt><span class="section"><a href="#d4e183">3.6. Interpreting JSR303 annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e233">4. Using OVal for programming by contract</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e246">4.1. Preparing your project</a></span></dt><dt><span class="section"><a href="#d4e263">4.2. Working with preconditions</a></span></dt><dt><span class="section"><a href="#d4e349">4.3. Working with postconditions</a></span></dt><dt><span class="section"><a href="#d4e429">4.4. Working with invariants</a></span></dt><dt><span class="section"><a href="#d4e464">4.5. Using the probe mode to simplify UI user input validation</a></span></dt><dt><span class="section"><a href="#d4e473">4.6. Converting ConstraintsViolatedExceptions</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e485">5. Creating custom annotation based constraints</a></span></dt><dt><span class="section"><a href="#d4e528">6. Expressing complex class specific constraints</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e531">6.1. Using @ValidateWithMethod</a></span></dt><dt><span class="section"><a href="#d4e536">6.2. Using @CheckWith</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e543">7. XML based configuration</a></span></dt><dt><span class="section"><a href="#d4e551">8. Additional configuration and customization options</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e553">8.1. Constraint profiles</a></span></dt><dt><span class="section"><a href="#d4e571">8.2. Collection factory</a></span></dt><dt><span class="section"><a href="#d4e579">8.3. Adding additional expression languages</a></span></dt><dt><span class="section"><a href="#d4e587">8.4. Spring integration</a></span></dt><dt><span class="section"><a href="#d4e602">8.5. Apache Struts 2 integration</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e606">9. API documentation</a></span></dt><dt><span class="section"><a href="#d4e610">10. Download</a></span></dt><dt><span class="section"><a href="#d4e656">11. References</a></span></dt><dt><span class="section"><a href="#d4e764">12. Acknowledgements</a></span></dt><dt><span class="section"><a href="#d4e770">13. Trademark disclaimer</a></span></dt></dl></div>
  

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e4"></a>1.&nbsp;What is OVal?</h2></div></div></div>
    

    <p>OVal is a pragmatic and extensible general purpose validation
    framework for any kind of Java objects (not only JavaBeans) and allows
    you:</p>

    <div class="itemizedlist"><ul type="disc"><li>
        <p>to easily validate objects on demand,</p>
      </li><li>
        <p>to specify constraints for class fields and getter
        methods,</p>
      </li><li>
        <p>to validate objects based on certain EJB3 JPA annotations
        (namely all field annotations that require a not-null value),</p>
      </li><li>
        <p>to configure constraints via annotations, POJOs and/or simple
        XML files,</p>
      </li><li>
        <p>to express constraints using scripting languages such as Groovy,
        BeanShell, and JavaScript</p>
      </li><li>
        <p>to easily create custom constraints, and</p>
      </li><li>
        <p>to develop new constraint configuration mechanisms</p>
      </li></ul></div>

    <p>When using AspectJ certain programming by contract (aka
    <span class="trademark">Design By Contract</span>&#8482; or DBC) features are
    available:</p>

    <div class="itemizedlist"><ul type="disc"><li>
        <p>specifying constraints for <span class="emphasis"><em>constructor
        parameters</em></span> that are automatically checked when a
        constructor is called (preconditions),</p>
      </li><li>
        <p>specifying constraints for <span class="emphasis"><em>method
        parameters</em></span> that are automatically checked when a method is
        called (preconditions),</p>
      </li><li>
        <p>requiring a certain object state before a method is called
        (preconditions)</p>
      </li><li>
        <p>enforcing object validation after an object has been created
        (invariants),</p>
      </li><li>
        <p>enforcing object validation before/after a method of an object
        is/has been called (invariants),</p>
      </li><li>
        <p>specifying constrains for a method's return value that are
        automatically checked after a method has been executed
        (postconditions),</p>
      </li><li>
        <p>requiring a certain object state after a method is called
        (postconditions).</p>
      </li></ul></div>

    <p>Missing a useful feature? Let's discuss it in the <a class="ulink" href="http://sourceforge.net/forum/forum.php?forum_id=488109" target="'_self'">OVal
    forum</a></p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e43"></a>2.&nbsp;Dependencies</h2></div></div></div>
    

    <p>OVal requires Java 5 or later - mainly for annotation support but
    other new language features (generics, for each loop, etc.) are used
    across the OVal source code too. Java 5 is actually the only hard
    requirement, depending on the features you want to use additional
    libraries are required:</p>

    <div class="itemizedlist"><ul type="disc"><li>
        <p>AspectJ is required if you want to use the above mentioned
        programming by contract features.</p>
      </li><li>
        <p>Apache Commons JEXL is required if you want to define
        constraints via JEXL expressions.</p>
      </li><li>
        <p>BeanShell is required if you want to define constraints via
        BeanShell expressions.</p>
      </li><li>
        <p>Groovy is required if you want to define constraints via Groovy
        expressions.</p>
      </li><li>
        <p>JRuby is required if you want to define constraints via Ruby
        expressions.</p>
      </li><li>
        <p>Mozilla Rhino is required if you want to define constraints via
        JavaScript expressions.</p>
      </li><li>
        <p>MVEL is required if you want to define constraints via MVEL
        expressions.</p>
      </li><li>
        <p>OGNL is required if you want to define constraints via OGNL
        expressions.</p>
      </li><li>
        <p>XStream is required if you want to configure OVal via XML
        configuration files.</p>
      </li><li>
        <p>GNU Trove is required if you want to have OVal to internally use
        the GNU Trove high performance collections.</p>
      </li><li>
        <p>Javolution is required if you want to have OVal to internally
        use Javolution's high performance collections.</p>
      </li><li>
        <p>JUnit and all other libraries are required if you want to run
        the test cases.</p>
      </li></ul></div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e71"></a>3.&nbsp;Using OVal for property validation</h2></div></div></div>
    

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e73"></a>3.1.&nbsp;Declaring constraints for class fields</h3></div></div></div>
      

      <p>You can add constraint annotations to class fields that are
      checked when an object validation is performed. There exists a number of
      pre-built constraints that you can find in the package
      <span class="command"><strong>net.sf.oval.constraint</strong></span> .</p>

      <p>An object can be validated by using the <span class="command"><strong>public
      validate(Object validatedObject)</strong></span> method of
      <span class="command"><strong>net.sf.oval.Validator</strong></span></p>

      <pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject {

  @NotNull
  @NotEmpty
  @Length(max=32)
  <b class="hl-keyword">private</b> String name;

  ...
}
</pre>

      <p>Example usage:</p>

      <pre class="programlisting">Validator validator = <b class="hl-keyword">new</b> Validator();

BusinessObject bo = <b class="hl-keyword">new</b> BusinessObject(); <i class="hl-comment" style="color: silver">// name is null</i>

<i class="hl-comment" style="color: silver">// collect the constraint violations</i>
List&lt;ConstraintViolation&gt; violations = validator.validate(bo);

<b class="hl-keyword">if</b>(violations.size()&gt;0)
{
  LOG.severe(<b class="hl-string"><i style="color:red">"Object "</i></b> + bo + <b class="hl-string"><i style="color:red">" is invalid."</i></b>);
  <b class="hl-keyword">throw</b> <b class="hl-keyword">new</b> BussinessException(violations);
}
</pre>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e83"></a>3.2.&nbsp;Declaring constraints for getter methods' return value</h3></div></div></div>
      

      <p>You can specify constraints for the return value of getter
      methods. When validating the object the values of all fields and the
      return values of the getter methods are checked against the specified
      constraints.</p>

      <p>The methods need to be annotated with
      <span class="command"><strong>@net.sf.oval.configuration.annotation.IsInvariant</strong></span>
      Return value constraints specified for methods missing this annotation
      are ignored during validation.</p>

      <p><span class="emphasis"><em>Important:</em></span> To retrieve the return value of
      the getter method OVal invokes the getter during the validation process.
      Therefore you need to ensure that the getter method really is just a
      getter method and does not change the object state.</p>

      <pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject
{
  <b class="hl-keyword">private</b> String name = null;

  @IsInvariant
  @NotNull 
  @Length(max = 4)
  <b class="hl-keyword">public</b> String getName() 
  {
    <b class="hl-keyword">return</b> name;
  }

  ...
}
</pre>

      <p>Example usage:</p>

      <pre class="programlisting">Validator validator = <b class="hl-keyword">new</b> Validator();

BusinessObject bo = <b class="hl-keyword">new</b> BusinessObject(<b class="hl-string"><i style="color:red">"blabla"</i></b>);

<i class="hl-comment" style="color: silver">// collect the constraint violations </i>
List&lt;ConstraintViolation&gt; violations = validator.validate(bo);

<b class="hl-keyword">if</b>(violations.size()&gt;0)
{
  LOG.severe(<b class="hl-string"><i style="color:red">"Object "</i></b> + bo + <b class="hl-string"><i style="color:red">" is invalid."</i></b>);
  <b class="hl-keyword">throw</b> <b class="hl-keyword">new</b> BussinessException(violations);
}
</pre>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e93"></a>3.3.&nbsp;Declaring conditional constraints using expression
      languages</h3></div></div></div>
      

      <p>When you annotate a field or getter with multiple constraint
      annotations they are ANDed. If you require other logical constructs you
      can use a scripting language to express them. To do so annotate the
      field or getter with the
      <span class="command"><strong>@net.sf.oval.constraint.Assert</strong></span> annotation as shown in
      the following example:</p>

      <pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject 
{
  @NotNull
  <b class="hl-keyword">public</b> String deliveryAddress;

  @NotNull <b class="hl-keyword">public</b> String invoiceAddress;

  <i class="hl-comment" style="color: silver">// mailingAddress must either be the delivery address or the invoice address </i>
  @Assert(expr = <b class="hl-string"><i style="color:red">"_value ==_this.deliveryAddress || _value == _this.invoiceAddress"</i></b>, lang = <b class="hl-string"><i style="color:red">"groovy"</i></b>)
  <b class="hl-keyword">public</b> String mailingAddress;
}
</pre>

      <p>The <span class="command"><strong>expr</strong></span> parameter holds the script to be
      evaluated. If the script returns <span class="command"><strong>true</strong></span> the constraint
      is satisfied. OVal provides two special variables:</p>

      <div class="itemizedlist"><ul type="disc"><li>
          <p><span class="command"><strong>_value</strong></span> - contains the value to validate
          (field value or getter return value)</p>
        </li><li>
          <p><span class="command"><strong>_this</strong></span> - is a reference to the validated
          object</p>
        </li></ul></div>

      <p>The <span class="command"><strong>lang</strong></span> parameter specifies the scripting
      language you want to use. In case the required libraries are loaded,
      OVal is aware of these languages:</p>

      <div class="itemizedlist"><ul type="disc"><li>
          <p><span class="command"><strong>bsh</strong></span> or <span class="command"><strong>beanshell</strong></span> for
          BeanShell,</p>
        </li><li>
          <p><span class="command"><strong>groovy</strong></span> for Groovy,</p>
        </li><li>
          <p><span class="command"><strong>jexl</strong></span> for JEXL,</p>
        </li><li>
          <p><span class="command"><strong>js</strong></span> or <span class="command"><strong>javascript</strong></span> for
          JavaScript (via Mozilla Rhino),</p>
        </li><li>
          <p><span class="command"><strong>mvel</strong></span> for MVEL,</p>
        </li><li>
          <p><span class="command"><strong>ognl</strong></span> for OGNL,</p>
        </li><li>
          <p><span class="command"><strong>ruby</strong></span> or <span class="command"><strong>jruby</strong></span> for Ruby
          (via JRuby)</p>
        </li></ul></div>

      <p>Additional scripting languages can be registered via
      <span class="command"><strong>Validator.addExpressionLanguage(String,
      ExpressionLanguage)</strong></span> .</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e137"></a>3.4.&nbsp;Declaring activation rules for constraints</h3></div></div></div>
      

      <p>Besides using @Assert to declare conditional constraints it is
      also possible to specify a activation rules for other constraints using
      the <span class="command"><strong>when</strong></span> attribute. This way you can for example turn
      on or off constraints based on a given state of the object. The
      <span class="command"><strong>when</strong></span> attribute can hold a formula in one of the
      supported expression languages, it is prefixed by the id of the
      expression language to be used.</p>

      <p>In the following example <span class="command"><strong>fieldB</strong></span> must not be
      <span class="command"><strong>null</strong></span> only if <span class="command"><strong>fieldA</strong></span> is not
      <span class="command"><strong>null</strong></span> as well. With the prefix
      <span class="command"><strong>groovy:</strong></span> it is indicated that the formula is expressed
      in the Groovy language. </p>

      <pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject
{
  <b class="hl-keyword">private</b> String fieldA;

  @NotNull(when = <b class="hl-string"><i style="color:red">"groovy:_this.fieldA != null"</i></b>)
  <b class="hl-keyword">private</b> String fieldB;
}</pre>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e149"></a>3.5.&nbsp;Interpreting EJB3 JPA annotations</h3></div></div></div>
      

      <p>OVal's configuration mechanism is highly customizable. Using the
      <span class="command"><strong>net.sf.oval.configuration.Configurer</strong></span> interface you
      can write your own constraint configurers configuring OVal based on
      other XML schemas, other sets of annotations or anything else you
      like.</p>

      <p>OVal comes with a configurer that is capable of translating
      certain EJB3 JPA annotations into equivalent OVal constraints. The
      <span class="command"><strong>net.sf.oval.configuration.annotation.JPAAnnotationsConfigurer</strong></span>
      interprets the EJB3 JPA annotations as follows:</p>

      <div class="itemizedlist"><ul type="disc"><li>
          <p><span class="command"><strong>@javax.persistence.Basic(optional=false) =&gt;
          @net.sf.oval.constraint.NotNull </strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.persistence.OneToOne(optional=false) =&gt;
          @net.sf.oval.constraint.NotNull </strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.persistence.OneToOne =&gt;
          @net.sf.oval.constraint.AssertValid</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.persistence.OneToMany =&gt;
          @net.sf.oval.constraint.AssertValid</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.persistence.ManyToOne(optional=false) =&gt;
          @net.sf.oval.constraint.NotNull </strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.persistence.ManyToOne =&gt;
          @net.sf.oval.constraint.AssertValid</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.persistence.Column(nullable=false) =&gt;
          @net.sf.oval.constraint.NotNull (only applied for fields not
          annotated with @javax.persistence.GeneratedValue or
          @javax.persistence.Version) </strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.persistence.Column(length=5) =&gt;
          @net.sf.oval.constraint.Length</strong></span></p>
        </li></ul></div>

      <pre class="programlisting">@Entity <b class="hl-keyword">public</b> <b class="hl-keyword">class</b> MyEntity 
{
  @Basic(optional = false) 
  @Column(length = 4) 
  <b class="hl-keyword">public</b> String id;

  @Column(nullable = false) 
  <b class="hl-keyword">public</b> String descr;

  @ManyToOne(optional = false) 
  <b class="hl-keyword">public</b> MyEntity parent;
}
</pre>

      <p>Example usage:</p>

      <pre class="programlisting"><i class="hl-comment" style="color: silver">// configure OVal to interprete OVal constraint annotations as well as EJB3 JPA annotations</i>
Validator validator = <b class="hl-keyword">new</b> Validator(<b class="hl-keyword">new</b> AnnotationsConfigurer(), <b class="hl-keyword">new</b> JPAAnnotationsConfigurer());

MyEntity entity = <b class="hl-keyword">new</b> MyEntity();

entity.id = <b class="hl-string"><i style="color:red">"12345"</i></b>; <i class="hl-comment" style="color: silver">// violation - the max length is 4 </i>
entity.descr = null; <i class="hl-comment" style="color: silver">// violation - cannot be null </i>
entity.parent = null; <i class="hl-comment" style="color: silver">// violation - cannot be null</i>

<i class="hl-comment" style="color: silver">// collect the constraint violations </i>
List&lt;ConstraintViolation&gt; violations = validator.validate(entity);
</pre>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e183"></a>3.6.&nbsp;Interpreting JSR303 annotations</h3></div></div></div>
      

      <p>OVal itself is not a JSR303 compliant bean validation framework. However it now comes with 
      a configurer that can translate the JSR303 built-in standard constraints into equivalent OVal constraints. The
      <span class="command"><strong>net.sf.oval.configuration.annotation.BeanValidationAnnotationsConfigurer</strong></span>
      interprets the JSR303 annotations as follows:</p>

      <div class="itemizedlist"><ul type="disc"><li>
          <p><span class="command"><strong>@javax.validation.constraints.AssertFalse =&gt; @net.sf.oval.constraint.AssertTrue</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.AssertTrue =&gt; @net.sf.oval.constraint.AssertTrue </strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.DecimalMax =&gt; @net.sf.oval.constraint.Max</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.DecimalMin =&gt; @net.sf.oval.constraint.Min</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Digits =&gt; @net.sf.oval.constraint.Digits </strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Future =&gt; @net.sf.oval.constraint.Future</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Max =&gt; @net.sf.oval.constraint.Max</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Min =&gt; @net.sf.oval.constraint.Min</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.NotNull =&gt; @net.sf.oval.constraint.NotNull</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Null =&gt; @net.sf.oval.constraint.Null</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Past =&gt; @net.sf.oval.constraint.Past</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Pattern =&gt; @net.sf.oval.constraint.Pattern</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Size =&gt; @net.sf.oval.constraint.Size</strong></span></p>
        </li><li>
          <p><span class="command"><strong>@javax.validation.constraints.Valid =&gt; @net.sf.oval.constraint.AssertValid</strong></span></p>
        </li></ul></div>

      <pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">class</b> MyEntity 
{
  @javax.validation.constraints.NotNull
  @javax.validation.constraints.Size(max = 4)
  <b class="hl-keyword">public</b> String id;

  @javax.validation.constraints.NotNull
  <b class="hl-keyword">public</b> String descr;

  @javax.validation.constraints.NotNull
  <b class="hl-keyword">public</b> MyEntity parent;
}
</pre>

      <p>Example usage:</p>

      <pre class="programlisting"><i class="hl-comment" style="color: silver">// configure OVal to interprete OVal constraint annotations as well as built-in JSR303 annotations</i>
Validator validator = <b class="hl-keyword">new</b> Validator(<b class="hl-keyword">new</b> AnnotationsConfigurer(), <b class="hl-keyword">new</b> BeanValidationAnnotationsConfigurer());

MyEntity entity = <b class="hl-keyword">new</b> MyEntity();

entity.id = <b class="hl-string"><i style="color:red">"12345"</i></b>; <i class="hl-comment" style="color: silver">// violation - the max length is 4 </i>
entity.descr = null; <i class="hl-comment" style="color: silver">// violation - cannot be null </i>
entity.parent = null; <i class="hl-comment" style="color: silver">// violation - cannot be null</i>

<i class="hl-comment" style="color: silver">// collect the constraint violations </i>
List&lt;ConstraintViolation&gt; violations = validator.validate(entity);
</pre>
    </div>
    
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e233"></a>4.&nbsp;Using OVal for programming by contract</h2></div></div></div>
    

    <p>By utilizing AspectJ OVal provides support for several aspects of
    programming by contract - however it is not a full blown programming by
    contract implementation.</p>

    <p>With OVal you can</p>

    <div class="itemizedlist"><ul type="disc"><li>
        <p>enforce that a parameterized constructor/method is invoked only
        if the given arguments satisfy prior defined constraints
        (precondition)</p>
      </li><li>
        <p>enforce that a method is invoked only if the object is in a
        certain state (precondition/invariant)</p>
      </li><li>
        <p>enforce that the return value of a method must satisfy prior
        defined constraints (postcondition)</p>
      </li><li>
        <p>enforce that the object must be in a certain state after a
        method has been executed (postcondition/invariant)</p>
      </li></ul></div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e246"></a>4.1.&nbsp;Preparing your project</h3></div></div></div>
      

      <p>The easiest way to getting started is to use the <a class="ulink" href="http://www.eclipse.org/" target="'_self'"> <em class="citetitle">Eclipse IDE</em>
      </a> in conjunction with the <a class="ulink" href="http://www.eclipse.org/ajdt/" target="'_self'"> <em class="citetitle">AspectJ
      plug-in</em> </a> .</p>

      <p>Create a new AspectJ project or add AspectJ support to an existing
      Java project by right-clicking the project in the Package Explorer and
      selecting <span class="command"><strong>Convert To AspectJ Project</strong></span></p>

      <p>Add the <span class="command"><strong>net.sf.oval_x.x.jar</strong></span> file to your
      library path.</p>

      <p>Create a new aspect via <span class="command"><strong>File -&gt; New -&gt;
      Aspect</strong></span> that extends the abstract aspect
      <span class="command"><strong>net.sf.oval.guard.GuardAspect</strong></span> . When the new aspect
      is created the AspectJ builder will automatically weave the validation
      related code into your compiled classes annotated with
      <span class="command"><strong>@net.sf.oval.guard.Guarded</strong></span> .</p>

      <p>Now you can create all your business classes, add the
      <span class="command"><strong>@net.sf.oval.guard.Guarded</strong></span> annotation and define the
      required constraints using the built-in or custom constraint
      annotations.</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e263"></a>4.2.&nbsp;Working with preconditions</h3></div></div></div>
      

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e265"></a>4.2.1.&nbsp;Declaring constraints for constructor parameters</h4></div></div></div>
        

        <p>Constraints specified for constructor parameters are
        automatically checked when the constructor is invoked. Invocations of
        the constructor will be prohibited if any of the constraints is not
        satisfied. In such a case a
        <span class="command"><strong>net.sf.oval.exception.ConstraintsViolatedException</strong></span>
        will be thrown.</p>

        <pre class="programlisting">
@net.sf.oval.guard.Guarded 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject 
{
  <b class="hl-keyword">public</b> BusinessObject(@NotNull String name)
  { 
    <b class="hl-keyword">this</b>.name = name;
  }
  
  ... 
}
</pre>

        <p>Example usage:</p>

        <pre class="programlisting"><i class="hl-comment" style="color: silver">// throws a ConstraintsViolatedException because parameter name is null </i>
BusinessObject bo = <b class="hl-keyword">new</b>  BusinessObject(null);
</pre>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e272"></a>4.2.2.&nbsp;Declaring constraints for method parameters</h4></div></div></div>
        

        <p>Constraints specified for method parameters are automatically
        checked when the method is invoked. Invocations of to the method will
        be prohibited if any of the constraints is not satisfied. In such a
        case a
        <span class="command"><strong>net.sf.oval.exception.ConstraintsViolatedException</strong></span>
        will be thrown.</p>

        <pre class="programlisting">@net.sf.oval.guard.Guarded 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject
{
  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setName(@NotNull String name)
  {
    <b class="hl-keyword">this</b>.name = name;
  }
  ...
}
</pre>

        <p>Example usage:</p>

        <pre class="programlisting">BusinessObject bo = <b class="hl-keyword">new</b> BusinessObject(); 
bo.setName(null); <i class="hl-comment" style="color: silver">// throws a ConstraintsViolatedException because parameter name is null</i>
</pre>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e279"></a>4.2.3.&nbsp;Applying field constraints to constructor/method
        parameters</h4></div></div></div>
        

        <p>You can apply the constraints specified for a field in the same
        or a super class to any constructor or method parameter by using the
        <span class="command"><strong>@net.sf.oval.constraint.AssertFieldConstraints</strong></span>
        annotation.</p>

        <p>If you do not specify a field name within the
        <span class="command"><strong>@net.sf.oval.constraint.AssertFieldConstraints</strong></span>
        annotation the constraints of the field with the same name as the
        annotated parameter are applied to the parameter.</p>

        <p>If you specify a field name within the
        <span class="command"><strong>@net.sf.oval.constraint.AssertFieldConstraints</strong></span>
        annotation the constraints of the field with the specified name are
        applied to the annotated parameter.</p>

        <pre class="programlisting">@net.sf.oval.guard.Guarded 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject 
{
  @NotNull 
  @NotEmpty 
  @Length(max=10)
  <b class="hl-keyword">private</b> String name;

  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setName(@AssertFieldConstraints String name) 
  {
    <b class="hl-keyword">this</b>.name = name;
  }

  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setAlternativeName(@AssertFieldConstraints(<b class="hl-string"><i style="color:red">"name"</i></b>) String altName)
  {
    <b class="hl-keyword">this</b>.alternativeName = altName;
  }

  ...
}
</pre>

        <p>Example usage:</p>

        <pre class="programlisting">BusinessObject bo = <b class="hl-keyword">new</b> BusinessObject();

bo.setName(<b class="hl-string"><i style="color:red">""</i></b>); <i class="hl-comment" style="color: silver">// throws a ConstraintsViolatedException because parameter is empty</i>

bo.setAlternativeName(null); <i class="hl-comment" style="color: silver">// throws a ConstraintsViolatedException because parameter is null</i>
</pre>

        <p>If you like to apply the constraints of all fields to their
        corresponding setter methods you can alternatively set the
        <span class="command"><strong>applyFieldConstraintsToSetters</strong></span> property of the
        <span class="command"><strong>Guarded</strong></span> annotation to <span class="command"><strong>true</strong></span> .
        This is especially useful if you have a lot of setter methods and you
        are following the JavaBean convention. Important: The setter method
        must be declared within the same class as the property.</p>

        <pre class="programlisting">@net.sf.oval.guard.Guarded(applyFieldConstraintsToSetters=true) 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject
{
  @NotNull 
  @NotEmpty 
  @Length(max=10) 
  <b class="hl-keyword">private</b> String name;

  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setName(String name) 
  {
    <b class="hl-keyword">this</b>.name = name;
  }
  
  ... 
}
</pre>

        <p>Another convenience option is the
        <span class="command"><strong>applyFieldConstraintsToConstructors</strong></span> property of the
        <span class="command"><strong>Guarded</strong></span> annotation. If set to true, OVal applies
        the specified field constraints to the corresponding parameters of the
        declared constructors within the same class. In this context, a
        corresponding parameter is a constructor parameter with the same name
        and type as the field.</p>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e298"></a>4.2.4.&nbsp;Using scripted expressions for preconditions</h4></div></div></div>
        

        <p>Similar to the above described
        <span class="command"><strong>@net.sf.constraint.Assert</strong></span> constraint annotation for
        fields you can annotate a method with
        <span class="command"><strong>@net.sf.guard.Pre</strong></span> allowing you to express
        conditional constraints using a scripting language.</p>

        <pre class="programlisting">@Guarded <b class="hl-keyword">public</b> <b class="hl-keyword">class</b> Transaction
{
  <b class="hl-keyword">private</b> BigDecimal amount;

  <i class="hl-comment" style="color: silver">// ensure that amount is not null, ensure that value2add is greater than amount</i>
  @Pre(expr = <b class="hl-string"><i style="color:red">"_this.amount!=null &amp;&amp; amount2add&gt;_this.amount"</i></b>, lang = <b class="hl-string"><i style="color:red">"groovy"</i></b>)
  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> increase(BigDecimal amount2add) 
  {
    amount = amount.add(amount2add); 
  }
}
</pre>

        <p>The <span class="command"><strong>expr</strong></span> parameter holds the script to be
        evaluated. If the script returns <span class="command"><strong>true</strong></span> the
        constraint is satisfied. OVal provides special variables for use
        within the expression:</p>

        <div class="itemizedlist"><ul type="disc"><li>
            <p><span class="command"><strong>_args[]</strong></span> - array holding the method
            arguments</p>
          </li><li>
            <p><span class="command"><strong>_this</strong></span> - is a reference to the current
            object</p>
          </li><li>
            <p>additionally variables matching the parameter names are
            available</p>
          </li></ul></div>

        <p>The <span class="command"><strong>lang</strong></span> parameter specifies the scripting
        language you want to use. In case the required libraries are loaded,
        OVal is aware of these languages:</p>

        <div class="itemizedlist"><ul type="disc"><li>
            <p><span class="command"><strong>bsh</strong></span> or <span class="command"><strong>beanshell</strong></span> for
            BeanShell,</p>
          </li><li>
            <p><span class="command"><strong>groovy</strong></span> for Groovy,</p>
          </li><li>
            <p><span class="command"><strong>jexl</strong></span> for JEXL,</p>
          </li><li>
            <p><span class="command"><strong>js</strong></span> or <span class="command"><strong>javascript</strong></span> for
            JavaScript (via Mozilla Rhino),</p>
          </li><li>
            <p><span class="command"><strong>mvel</strong></span> for MVEL,</p>
          </li><li>
            <p><span class="command"><strong>ognl</strong></span> for OGNL, or</p>
          </li><li>
            <p><span class="command"><strong>ruby</strong></span> or <span class="command"><strong>jruby</strong></span> for Ruby
            (via JRuby)</p>
          </li></ul></div>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e343"></a>4.2.5.&nbsp;Disabling precondition checks</h4></div></div></div>
        

        <p>You can globally disable or enable the checking of preconditions
        via the <span class="command"><strong>Guard.setPreConditionsEnabled(boolean)</strong></span>
        method.</p>

        <p>Example usage:</p>

        <pre class="programlisting">MyAspect.aspectOf().getGuard().setPreConditionsEnabled(false);</pre>
      </div>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e349"></a>4.3.&nbsp;Working with postconditions</h3></div></div></div>
      

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e351"></a>4.3.1.&nbsp;Declaring method return value constraints</h4></div></div></div>
        

        <p>By adding constraint annotations to a non-void method you can
        specify constraints for the method's return value. When the method is
        invoked and the return value does not satisfy all constraints a
        ConstraintsViolatedException is thrown.</p>

        <p><span class="emphasis"><em>Note:</em></span> Despite the thrown exception the
        method code still has been executed, you have to rollback the changes
        performed by this method manually.</p>

        <p>If a non-void, non-parameterized method is also annotated with
        <span class="command"><strong>@IsInvariant</strong></span> it's constraints will also be checked
        when calling the <span class="command"><strong>Validator.validate(Object)</strong></span> method
        on an object of this type.</p>

        <pre class="programlisting">@net.sf.oval.guard.Guarded 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject 
{
  <b class="hl-keyword">private</b> String name = null;

  @IsInvariant 
  @NotNull 
  @Length(max = 4)
  <b class="hl-keyword">public</b> String getName()
  {
    <b class="hl-keyword">return</b> name;
  }

  @NotNull
  @Length(max = 4)
  <b class="hl-keyword">public</b> String getNameOrDefault(String <b class="hl-keyword">default</b>) 
  {
    <b class="hl-keyword">return</b> name == null ? <b class="hl-keyword">default</b> : name;
  }
  
  ...
}
</pre>

        <p>Example usage:</p>

        <pre class="programlisting">BusinessObject bo = <b class="hl-keyword">new</b> BusinessObject();

<i class="hl-comment" style="color: silver">// throws a ConstraintsViolatedException because field name is null</i>
bo.getName();

<i class="hl-comment" style="color: silver">// throws a ConstraintsViolatedException because the field "name" is null and therefore the default parameter will be returned which has a length &lt; 4 characters</i>
bo.getNameOrDefault(<b class="hl-string"><i style="color:red">"abc"</i></b>);

Validator validator = <b class="hl-keyword">new</b> Validator();

<i class="hl-comment" style="color: silver">// returns one ConstraintViolation because the getter method getName() is declared as invariant and returns an invalid value (null)</i>
List&lt;ConstraintViolation&gt; violations = validator.validate(bo);
</pre>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e362"></a>4.3.2.&nbsp;Using scripted expressions for postconditions</h4></div></div></div>
        

        <p>For declaring scripted postconditions you can use the
        <span class="command"><strong>@net.sf.guard.Post</strong></span> annotation which works Similar
        to <span class="command"><strong>@net.sf.guard.Pre</strong></span> for preconditions.</p>

        <pre class="programlisting">@Guarded <b class="hl-keyword">public</b> <b class="hl-keyword">class</b> Transaction 
{
  <b class="hl-keyword">private</b> BigDecimal amount;

  <i class="hl-comment" style="color: silver">// ensure that amount after calling the method is greater than it was before</i>
  @Post(expr = <b class="hl-string"><i style="color:red">"_this.amount&amp;gt;_old"</i></b>, old = <b class="hl-string"><i style="color:red">"_this.amount"</i></b>, lang = <b class="hl-string"><i style="color:red">"groovy"</i></b>)
  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> increase(BigDecimal  amount2add)
  {
    amount = amount.add(amount2add);
  }
}
</pre>

        <p>The <span class="command"><strong>expr</strong></span> parameter holds the script to be
        evaluated. If the script returns <span class="command"><strong>true</strong></span> the
        constraint is satisfied. OVal provides special variables for use
        within the expression:</p>

        <div class="itemizedlist"><ul type="disc"><li>
            <p><span class="command"><strong>_args[]</strong></span> - array holding the method
            arguments</p>
          </li><li>
            <p><span class="command"><strong>_this</strong></span> - is a reference to the current
            object</p>
          </li><li>
            <p><span class="command"><strong>_returns</strong></span> - the method's return
            value</p>
          </li><li>
            <p><span class="command"><strong>_old</strong></span> - see the description of the
            <span class="command"><strong>old</strong></span> parameter below</p>
          </li><li>
            <p>additionally variables matching the parameter names are
            available</p>
          </li></ul></div>

        <p>The <span class="command"><strong>lang</strong></span> parameter specifies the scripting
        language you want to use. In case the required libraries are loaded,
        OVal is aware of these languages:</p>

        <div class="itemizedlist"><ul type="disc"><li>
            <p><span class="command"><strong>bsh</strong></span> or <span class="command"><strong>beanshell</strong></span> for
            BeanShell,</p>
          </li><li>
            <p><span class="command"><strong>groovy</strong></span> for Groovy,</p>
          </li><li>
            <p><span class="command"><strong>jexl</strong></span> for Groovy,</p>
          </li><li>
            <p><span class="command"><strong>js</strong></span> or <span class="command"><strong>javascript</strong></span> for
            JavaScript (via Mozilla Rhino),</p>
          </li><li>
            <p><span class="command"><strong>mvel</strong></span> for MVEL,</p>
          </li><li>
            <p><span class="command"><strong>ognl</strong></span> for OGNL, or</p>
          </li><li>
            <p><span class="command"><strong>ruby</strong></span> or <span class="command"><strong>jruby</strong></span> for Ruby
            (via JRuby)</p>
          </li></ul></div>

        <p>The <span class="command"><strong>old</strong></span> parameter is optionally, it can hold
        another expression that is evaluated before the method is executed.
        The result is made available in the post constraint expression as a
        special variable called <span class="command"><strong>_old</strong></span> . The old expression
        can also return an array or a map allowing you to store multiple
        values. This way you can "remember" the old state of multiple
        properties of an object. An expression like <span class="command"><strong>old =
        "[amount:_this.amount, date:_this.date]"</strong></span> in Groovy returns a
        map with the keys <span class="command"><strong>amount</strong></span> and
        <span class="command"><strong>date</strong></span> holding the values of the object's properties
        <span class="command"><strong>amount</strong></span> and <span class="command"><strong>date</strong></span> . These values
        then can be used in the constraint expression like this:
        <span class="command"><strong>expression = "_this.amount&gt;_old.amount &amp;&amp;
        _this.date&gt;_old.date"</strong></span> .</p>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e423"></a>4.3.3.&nbsp;Disabling postcondition checks</h4></div></div></div>
        

        <p>You can globally disable or enable the checking of
        postconditions via the
        <span class="command"><strong>Guard.setPostConditionsEnabled(boolean)</strong></span>
        method.</p>

        <p>Example usage:</p>

        <pre class="programlisting">MyAspect.aspectOf().getGuard().setPostConditionsEnabled(false);</pre>
      </div>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e429"></a>4.4.&nbsp;Working with invariants</h3></div></div></div>
      

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e431"></a>4.4.1.&nbsp;Disabling automatic invariants checks</h4></div></div></div>
        

        <p>By default OVal checks class invariants before and after calls
        to any non-private method of guarded classes and after constructor
        execution. If required you can globally disable the automatic checking
        of invariants via the
        <span class="command"><strong>Guard.setInvariantsEnabled(boolean)</strong></span> method or for
        all objects of a specific class using the
        <span class="command"><strong>Guard.setInvariantsEnabled(Class&lt;?&gt;, boolean)</strong></span>
        method .</p>

        <p>Example usage:</p>

        <pre class="programlisting">MyAspect.aspectOf().getGuard().setInvariantsEnabled(false);</pre>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e438"></a>4.4.2.&nbsp;Enforcing object validation before method execution</h4></div></div></div>
        

        <p>If you disabled the automatic check of class invariants you can
        still enable the checking of the invariants prior calls to a certain
        method by annotating the respective method with
        <span class="command"><strong>@net.sf.oval.guard.PreValidateThis</strong></span> .</p>

        <p>In case of constraint violations a ConstraintsViolatedException
        is thrown and the method will not be executed.</p>

        <pre class="programlisting">@net.sf.oval.guard.Guarded 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject 
{
  @NotNull 
  <b class="hl-keyword">private</b> String name = null;

  @PreValidateThis 
  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> save() 
  {
    <i class="hl-comment" style="color: silver">// do something fancy</i>
  }

  ...
}
</pre>

        <p>Example usage:</p>

        <pre class="programlisting"><i class="hl-comment" style="color: silver">// create a new business object and leaving the field name null </i>
BusinessObject bo = <b class="hl-keyword">new</b>  BusinessObject();

<i class="hl-comment" style="color: silver">// the save() method will throw a ConstraintsViolatedException because field name is null</i>
bo.save();
</pre>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e446"></a>4.4.3.&nbsp;Enforcing object validation after constructor execution</h4></div></div></div>
        

        <p>If you disabled the automatic check of class invariants you can
        still enable the checking of the invariants after an object has been
        instantiated by annotating the constructors of the corresponding class
        with <span class="command"><strong>@net.sf.oval.guard.PostValidateThis</strong></span> .</p>

        <p>In case of constraint violations the constructor will throw a
        ConstraintsViolatedException which effectively means the code trying
        to instantiate the object cannot get hold of a reference to the object
        being in an invalidate state and the invalid object will get garbage
        collected.</p>

        <pre class="programlisting">@net.sf.oval.guard.Guarded 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject 
{
  @NotNull
  <b class="hl-keyword">private</b> String name;

  <i class="hl-comment" style="color: silver">/**
   * constructor 
   */</i>
  @PostValidateThis 
  <b class="hl-keyword">public</b> BusinessObject() 
  {
  }

  ...
}
</pre>

        <p>Example usage:</p>

        <pre class="programlisting"><i class="hl-comment" style="color: silver">// throws a ConstraintsViolatedException because the name field is null </i>
BusinessObject bo = <b class="hl-keyword">new</b>  BusinessObject();
</pre>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e454"></a>4.4.4.&nbsp;Enforcing object validation after method execution</h4></div></div></div>
        

        <p>If you disabled the automatic check of class invariants you can
        still enable the checking of the invariants after a method has been
        executed by annotating the method with
        <span class="command"><strong>@net.sf.oval.guard.PostValidateThis</strong></span> .</p>

        <p>In case of constraint violations the method will throw an
        ConstraintsViolatedException.</p>

        <p><span class="emphasis"><em>Note:</em></span> Despite the thrown exception the
        method code still has been executed, you have to manually rollback the
        changes performed by this method.</p>

        <pre class="programlisting">@net.sf.oval.guard.Guarded 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject 
{
  @Length(max=10)
  <b class="hl-keyword">private</b> String name = <b class="hl-string"><i style="color:red">"12345"</i></b>;

  @PostValidateThis 
  <b class="hl-keyword">public</b> appendToName(String appendix) 
  {
    name += appendix;
  }
  
  ...
}
</pre>

        <p>Example usage:</p>

        <pre class="programlisting">BusinessObject bo = <b class="hl-keyword">new</b> BusinessObject();
bo.appendToName(<b class="hl-string"><i style="color:red">"123456"</i></b>); <i class="hl-comment" style="color: silver">// throws a ConstraintsViolatedException because field name is now too long</i>
</pre>
      </div>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e464"></a>4.5.&nbsp;Using the probe mode to simplify UI user input validation</h3></div></div></div>
      

      <p>OVal provides a so called probe mode in which you can execute all
      methods of an object and the guard will only check the preconditions
      (e.g. parameter constraints) and not execute the method.</p>

      <p>This is especially useful if you want to test input values
      received from the end user in the UI layer against the setter methods of
      a business object. You can simply pass the values to the corresponding
      setters and have any detected violations collect by a
      <span class="command"><strong>ConstraintsViolatedListener</strong></span> . Afterwards you can
      report all violations back to the UI layer and have them displayed to
      the end user.</p>

      <p>Example business object:</p>

      <pre class="programlisting">@net.sf.oval.guard.Guarded 
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> Person 
{
  @NotNegative 
  <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> age;

  @Min(5)
  <b class="hl-keyword">private</b> String name = <b class="hl-string"><i style="color:red">""</i></b>;

  @Length(min=5, max=5)
  <b class="hl-keyword">private</b> String zipCode = <b class="hl-string"><i style="color:red">""</i></b>;

  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setAge(@FieldConstraints <b class="hl-keyword">int</b> age)
  {
    <b class="hl-keyword">this</b>.age = age;
  }

  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setName(@FieldConstraints String name) 
  {
    <b class="hl-keyword">this</b>.name = name;
  }

  <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setZipCode(@FieldConstraints String zipCode) 
  {
    <b class="hl-keyword">this</b>.zipCode = zipCode;
  }
  
  ...
}</pre>

      <p>Example usage:</p>

      <pre class="programlisting"><i class="hl-comment" style="color: silver">/* *****************************************************
 * somewhere in the UI layer
 * *****************************************************/</i>
 inputForm.setName(<b class="hl-string"><i style="color:red">"1234"</i></b>);
 inputForm.setAge(-4);
 inputForm.setZipCode(<b class="hl-string"><i style="color:red">"123"</i></b>);

...

<i class="hl-comment" style="color: silver">/* *****************************************************
 * later in the business layer
 * *****************************************************/</i>
<b class="hl-keyword">public</b> Person createPerson(PersonInputForm inputForm) <b class="hl-keyword">throws</b> ConstraintsViolatedException
{
  Person person = <b class="hl-keyword">new</b> Person();

  Guard guard = MyGuardAspect.aspectOf().getGuard();

  <i class="hl-comment" style="color: silver">// enable the probe mode in the current thread for the person object</i>
  guard.enableProbeMode(person);

  <i class="hl-comment" style="color: silver">// simulate applying the values to the person bean</i>
  person.setName(inputForm.getName());
  person.setAge(inputForm.getAge());
  person.setZipCode(inputForm.getZipCode());

  <i class="hl-comment" style="color: silver">// disable the probe mode in the current thread for the person object</i>
  ProbeModeListener result = guard.disableProbeMode(person);

  <i class="hl-comment" style="color: silver">// check if any constraint violations occured</i>
  <b class="hl-keyword">if</b>(result.getConstraintViolations().size() &gt; 0)
  {
     <i class="hl-comment" style="color: silver">// report the collected constraint violations to the UI layer</i>
     <b class="hl-keyword">throw</b> <b class="hl-keyword">new</b> ConstraintsViolatedException(result.getConstraintViolations());
  }
  <b class="hl-keyword">else</b>
  {
    <i class="hl-comment" style="color: silver">// apply the values to the person bean</i>
    result.commit();

    dao.save(person);
    <b class="hl-keyword">return</b> person;
  }
}

</pre>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e473"></a>4.6.&nbsp;Converting ConstraintsViolatedExceptions</h3></div></div></div>
      

      <p>When calling methods on guarded objects these methods will throw
      ConstraintsViolatedExceptions in case any pre- or postconditions are
      violated. Their might be good reasons why you may want to have other
      exceptions thrown instead of OVal's proprietary exceptions, e.g. JRE
      standard exceptions such as <span class="command"><strong>IllegalArgumentException</strong></span>
      or <span class="command"><strong>IllegalStateException</strong></span> .</p>

      <p>OVal's Guard class allows you to register an exception translator.
      The exception translator defines a
      <span class="command"><strong>translateException()</strong></span> method that is executed for all
      occurring exceptions during runtime validation. This allows you to
      translate any <span class="command"><strong>OValException</strong></span> thrown during validation
      into another <span class="command"><strong>RuntimeException</strong></span> which will be thrown
      instead. As an example have a look at the
      <span class="command"><strong>net.sf.oval.exception.ExceptionTranslatorJDKExceptionsImpl</strong></span>
      class how an implementation could look like.</p>

      <p>Example usage:</p>

      <pre class="programlisting"><b class="hl-keyword">public</b> aspect MyAspect <b class="hl-keyword">extends</b> GuardAspect 
{
  <b class="hl-keyword">public</b> MyAspect()
  {
    <b class="hl-keyword">super</b>();

    <i class="hl-comment" style="color: silver">// specify an exception translator</i>
    getGuard().setExceptionTranslator(<b class="hl-keyword">new</b> net.sf.oval.exception.ExceptionTranslatorJDKExceptionsImpl()); 
  }
}
</pre>
    </div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e485"></a>5.&nbsp;Creating custom annotation based constraints</h2></div></div></div>
    

    <p>Developing custom annotation based constraints is fairly easy. All
    you need to do is:</p>

    <div class="orderedlist"><ol type="1"><li>
        <p>Create a constraint check class that implements
        <span class="command"><strong>net.sf.oval.AnnotationCheck</strong></span> or extends
        <span class="command"><strong>net.sf.oval.AbstractAnnotationCheck</strong></span> .</p>

        <pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">class</b> UpperCaseCheck <b class="hl-keyword">extends</b> AbstractAnnotationCheck&lt;UpperCase&gt;
{
  <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isSatisfied(Object validatedObject, Object valueToValidate, OValContext context, Validator validator)
  {
    <b class="hl-keyword">if</b> (valueToValidate == null) <b class="hl-keyword">return</b> true;

    String val = valueToValidate.toString();
    
    <b class="hl-keyword">return</b> val.equals(val.toUpperCase());
  }
}
</pre>
      </li><li>
        <p>Create an annotation for your constraint and annotated it with
        <span class="command"><strong>@net.sf.oval.configuration.annotation.Constraint</strong></span> . Specify your check class
        as value for parameter "check".</p>

        <pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD})
@net.sf.oval.configuration.annotation.Constraint(check = UpperCaseCheck.<b class="hl-keyword">class</b>)
<b class="hl-keyword">public</b> @<b class="hl-keyword">interface</b> UpperCase
{
  <i class="hl-comment" style="color: silver">/**
  * message to be used for the ConstraintsViolatedException 
  *
  * @see ConstraintsViolatedException
  */</i>
  String message() <b class="hl-keyword">default</b> <b class="hl-string"><i style="color:red">"must be upper case"</i></b>;
}
</pre>
      </li><li>
        <p>Use the custom constraint annotation in your code.</p>

        <pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">class</b> BusinessObject 
{
  @UpperCase 
  <b class="hl-keyword">private</b> String userId;

  ...
}
</pre>
      </li></ol></div>

    <p>Localization of the constraint violation message can be achieved as
    follows:</p>

    <div class="orderedlist"><ol type="1"><li>
        <p>Specify a unique message key for the default message string of
        the constraint annotation, e.g.</p>

        <pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD})
@net.sf.oval.configuration.annotation.Constraint(check = UpperCaseCheck.<b class="hl-keyword">class</b>)
<b class="hl-keyword">public</b> @<b class="hl-keyword">interface</b> UpperCase
{
  <i class="hl-comment" style="color: silver">/**
   * message to be used for the ConstraintsViolatedException 
   *
   * @see ConstraintsViolatedException
   */</i>
  String message() <b class="hl-keyword">default</b> <b class="hl-string"><i style="color:red">"UpperCase.violated"</i></b>;
}
</pre>
      </li><li>
        <p>Create custom message bundles (one per language) and specify the
        translated sting in each bundle:</p>

        <pre class="programlisting">UpperCase.violated={context} must be upper <b class="hl-keyword">case</b></pre>

        <p>There exist two default variables that can be used in the
        message string:</p>

        <div class="itemizedlist"><ul type="disc"><li>
            <p><span class="command"><strong>{context}</strong></span> = the validation context (e.g.
            a field, a method return value or a constructor/method
            parameter</p>
          </li><li>
            <p><span class="command"><strong>{invalidValue}</strong></span> = the value that has been
            checked</p>
          </li></ul></div>

        <p>If required, you can introduce additional variables - e.g. which
        reflect additional configuration properties of your constraint such as
        {max}, {min}, {size} - by overriding the
        <span class="command"><strong>createMessageVariables</strong></span> method of your custom check
        class:</p>

        <pre class="programlisting">@Override
<b class="hl-keyword">public</b> Map&lt;String, String&gt; createMessageVariables()
{
  Map&lt;String, String&gt; messageVariables = <b class="hl-keyword">new</b> HashMap&lt;String, String&gt;(2)
  messageVariables.put(<b class="hl-string"><i style="color:red">"max"</i></b>, Integer.toString(max));
  messageVariables.put(<b class="hl-string"><i style="color:red">"min"</i></b>, Integer.toString(min));
  <b class="hl-keyword">return</b> messageVariables;
}
</pre>

        <p>The message variables can then be used in the corresponding
        message strings.</p>
      </li><li>
        <p>Register your message bundle with OVal:</p>

        <pre class="programlisting">ResourceBundleMessageResolver resolver = (ResourceBundleMessageResolver) Validator.getMessageResolver();
resolver.addMessageBundle(ResourceBundle.getBundle(<b class="hl-string"><i style="color:red">"mypackage/CustomMessages"</i></b>));
</pre>

        <p>If you would like to store your message strings other than in
        message bundles (e.g. in a database): Either implement the
        <span class="command"><strong>MessageResolver</strong></span> interface or extend the
        <span class="command"><strong>ResourceBundleMessageResolver</strong></span> and then configure
        OVal using the static
        <span class="command"><strong>Validator.setMessageResolver(...)</strong></span> method to use an
        instance of your custom message resolver instead.</p>
      </li></ol></div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e528"></a>6.&nbsp;Expressing complex class specific constraints</h2></div></div></div>
    

    <p>If you have to express a rather complex constraint that is used only
    within one class you might not want to implement it as a custom
    constraint. You have the following two alternatives expressing such class
    specific constraints in a convenient way.</p>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e531"></a>6.1.&nbsp;Using @ValidateWithMethod</h3></div></div></div>
      

      <p>You can write a method within the class that has a single
      parameter to receive the value to validate and that returns true if the
      constraint is satisfied and false if it is violated.</p>

      <p>Example:</p>

      <pre class="programlisting"><b class="hl-keyword">private</b> <b class="hl-keyword">static</b> <b class="hl-keyword">class</b> TestEntity
{
  @Min(1960)
  <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> year = 1977;

  @Range(min=1, max=12)
  <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> month = 2;

  @ValidateWithMethod(methodName = <b class="hl-string"><i style="color:red">"isValidDay"</i></b>, parameterType = <b class="hl-keyword">int</b>.<b class="hl-keyword">class</b>)
  <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> day = 31;

  <b class="hl-keyword">private</b> <b class="hl-keyword">boolean</b> isValidDay(<b class="hl-keyword">int</b> day)
  {
    GregorianCalendar cal = <b class="hl-keyword">new</b> GregorianCalendar();
    cal.setLenient(false);
    cal.set(GregorianCalendar.YEAR, year); 
    cal.set(GregorianCalendar.MONTH, month - 1);
    cal.set(GregorianCalendar.DATE, day);
    <b class="hl-keyword">try</b> {
      cal.getTimeInMillis(); <i class="hl-comment" style="color: silver">// throws IllegalArgumentException</i>
    } <b class="hl-keyword">catch</b> (IllegalArgumentException e) { 
      <b class="hl-keyword">return</b> false;
    }
    <b class="hl-keyword">return</b> true;
  }
}
</pre>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e536"></a>6.2.&nbsp;Using @CheckWith</h3></div></div></div>
      

      <p>You can write an inner static class extending
      <span class="command"><strong>net.sf.oval.constraint.CheckWithCheck.SimpleCheck</strong></span>
      which then is referenced via a
      <span class="command"><strong>@net.sf.oval.constraint.CheckWith</strong></span> constraint
      annotation.</p>

      <p>Example:</p>

      <pre class="programlisting"><b class="hl-keyword">private</b> <b class="hl-keyword">static</b> <b class="hl-keyword">class</b> DayEntity
{
  @Min(1960)
  <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> year;

  @Range(min=1, max=12)
  <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> month;

  @CheckWith(DayCheck.<b class="hl-keyword">class</b>)
  <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> day;

  <b class="hl-keyword">private</b> <b class="hl-keyword">static</b> <b class="hl-keyword">class</b> DayCheck <b class="hl-keyword">implements</b> CheckWithCheck.SimpleCheck
  {
    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isSatisfied(Object validatedObject, Object value)
    {
      <b class="hl-keyword">try</b> {
        GregorianCalendar cal = <b class="hl-keyword">new</b> GregorianCalendar();
        cal.setLenient(false);
        cal.set(GregorianCalendar.YEAR, ((DayEntity) validatedObject).year);
        cal.set(GregorianCalendar.MONTH, ((DayEntity) validatedObject).month - 1);
        cal.set(GregorianCalendar.DATE, ((DayEntity) validatedObject).day);
        cal.getTimeInMillis(); <i class="hl-comment" style="color: silver">// may throw IllegalArgumentException return true;</i>
      } <b class="hl-keyword">catch</b> (IllegalArgumentException e) {}
      <b class="hl-keyword">return</b> false;
    }
  }
}
</pre>
    </div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e543"></a>7.&nbsp;XML based configuration</h2></div></div></div>
    

    <p>By default the constraints configuration is done by adding
    annotations representing the constraints to the respective locations in
    the source code. Alternatively constraints can also be declared via XML -
    either for a complete configuration or to overwrite the annotations based
    constraint configurations for specific classes, fields, etc.</p>

    <p>You can used the
    <span class="command"><strong>net.sf.oval.configuration.xml.XMLConfigurer</strong></span> for loading
    constraint definitions from an XML file:</p>

    <pre class="programlisting">XMLConfigurer xmlConfigurer = <b class="hl-keyword">new</b> XMLConfigurer(<b class="hl-keyword">new</b> File(<b class="hl-string"><i style="color:red">"oval-config.xml"</i></b>));
Guard guard = <b class="hl-keyword">new</b> Guard(xmlConfigurer);
</pre>

    <p>Here is an example XML configuration:</p>

    <pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" ?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">oval</b>
  <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://oval.sf.net/oval-configuration"</span>
  <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://http://www.w3.org/2001/XMLSchema-instance"</span> 
  <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://oval.sf.net/oval-configuration http://oval.sourceforge.net/oval-configuration-1.3.xsd"</span>
&gt;
  &lt;<i class="hl-comment" style="color: silver">!-- define a constraint set --</i>&gt;
  &lt;<b class="hl-tag" style="color: blue">constraintSet</b> <span class="hl-attribute" style="color: blue">id</span>=<span class="hl-value" style="color: blue">"user.userid"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">notNull</b> /&gt;
    &lt;<b class="hl-tag" style="color: blue">matchPattern</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">pattern</b> <span class="hl-attribute" style="color: blue">pattern</span>=<span class="hl-value" style="color: blue">"^[a-z0-9]{8}$"</span> <span class="hl-attribute" style="color: blue">flags</span>=<span class="hl-value" style="color: blue">"0"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">/matchPattern</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/constraintSet</b>&gt;

  &lt;<i class="hl-comment" style="color: silver">!-- define checks for the acme.model.User class --</i>&gt;
  &lt;<i class="hl-comment" style="color: silver">!-- overwrite=false means already defined checks for this class will not be removed --</i>&gt;
  &lt;<b class="hl-tag" style="color: blue">class</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"acme.model.User"</span> <span class="hl-attribute" style="color: blue">overwrite</span>=<span class="hl-value" style="color: blue">"false"</span> <span class="hl-attribute" style="color: blue">applyFieldConstraintsToSetter</span>=<span class="hl-value" style="color: blue">"true"</span>&gt;

    &lt;<b class="hl-tag" style="color: blue">field</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"firstName"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">length</b> <span class="hl-attribute" style="color: blue">min</span>=<span class="hl-value" style="color: blue">"0"</span> <span class="hl-attribute" style="color: blue">max</span>=<span class="hl-value" style="color: blue">"3"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">/field</b>&gt;

    &lt;<b class="hl-tag" style="color: blue">field</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"lastName"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">length</b> <span class="hl-attribute" style="color: blue">min</span>=<span class="hl-value" style="color: blue">"0"</span> <span class="hl-attribute" style="color: blue">max</span>=<span class="hl-value" style="color: blue">"5"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">/field</b>&gt;

    &lt;<i class="hl-comment" style="color: silver">!-- overwrite=true means previously defined checks for this field will be overwritten by the checks defined here --</i>&gt;
    &lt;<b class="hl-tag" style="color: blue">field</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"managerId"</span> <span class="hl-attribute" style="color: blue">overwrite</span>=<span class="hl-value" style="color: blue">"true"</span>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- use the checks defined for the constaint set "user.userid" --</i>&gt;
      &lt;<b class="hl-tag" style="color: blue">assertConstraint</b> <span class="hl-attribute" style="color: blue">id</span>=<span class="hl-value" style="color: blue">"user.userid"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">/field</b>&gt;

    &lt;<b class="hl-tag" style="color: blue">field</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"userId"</span> <span class="hl-attribute" style="color: blue">overwrite</span>=<span class="hl-value" style="color: blue">"true"</span>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- use the checks defined for the constaint set "user.userid" --</i>&gt;
      &lt;<b class="hl-tag" style="color: blue">assertConstraintSet</b> <span class="hl-attribute" style="color: blue">id</span>=<span class="hl-value" style="color: blue">"user.userid"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">/field</b>&gt;

    &lt;<i class="hl-comment" style="color: silver">!-- define constructor parameter checks --</i>&gt;
    &lt;<b class="hl-tag" style="color: blue">constructor</b>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- parameter1 --</i>&gt;
      &lt;<b class="hl-tag" style="color: blue">parameter</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"java.lang.String"</span>&gt;
        &lt;<b class="hl-tag" style="color: blue">notNull</b> /&gt;
      &lt;<b class="hl-tag" style="color: blue">/parameter</b>&gt;

      &lt;<i class="hl-comment" style="color: silver">!-- parameter 2 --</i>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- the types of all parameters must be listed, even if no checks are defined --</i>&gt;
      &lt;<b class="hl-tag" style="color: blue">parameter</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"java.lang.String"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">/constructor</b>&gt;

    &lt;<i class="hl-comment" style="color: silver">!-- define method parameter checks --</i>&gt;
    &lt;<b class="hl-tag" style="color: blue">method</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"setPasswordExpirationDays"</span>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- parameter 1 --</i>&gt;
      &lt;<b class="hl-tag" style="color: blue">parameter</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"int"</span>&gt;
        &lt;<b class="hl-tag" style="color: blue">notNull</b> /&gt;
      &lt;<b class="hl-tag" style="color: blue">/parameter</b>&gt;
     &lt;<b class="hl-tag" style="color: blue">/method</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/class</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/oval</b>&gt;
</pre>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e551"></a>8.&nbsp;Additional configuration and customization options</h2></div></div></div>
    

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e553"></a>8.1.&nbsp;Constraint profiles</h3></div></div></div>
      

      <p>You may come across the requirement to turn on or off the checking
      of certain constraints across your domain model, e.g. based on some
      global configuration settings of the application. OVal helps you to
      implement this by introducing constraint profiles. For each declared
      constraint you can specify an infinite number of profiles this
      constraint belongs to. During runtime you then can enable or disable all
      constraints associated with a given profile by using the
      <span class="command"><strong>disableProfile</strong></span> , and <span class="command"><strong>enableProfile</strong></span>
      methods of the <span class="command"><strong>Validator</strong></span> instance. Constraints not
      having any profiles declared are automatically assigned a profile named
      <span class="command"><strong>default</strong></span>.</p>

      <pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">class</b> Person
{
  @NotNull(profiles = {<b class="hl-string"><i style="color:red">"profile1"</i></b>})
  <b class="hl-keyword">public</b> String firstName;

  @NotNull(profiles = {<b class="hl-string"><i style="color:red">"profile1"</i></b>})
  <b class="hl-keyword">public</b> String lastName;

  @NotNull(profiles = {<b class="hl-string"><i style="color:red">"profile2"</i></b>, <b class="hl-string"><i style="color:red">"profile3"</i></b>})
  <b class="hl-keyword">public</b> String zipCode;
}
</pre>

      <p>Example usage:</p>

      <pre class="programlisting">Validator v = <b class="hl-keyword">new</b> Validator();
v.disableProfile(<b class="hl-string"><i style="color:red">"profile1"</i></b>);

Person p = <b class="hl-keyword">new</b> Person();
v.validate(p);
</pre>

      <p>In this case only the null value <span class="command"><strong>zipCode</strong></span>
      property will result in a <span class="command"><strong>ConstraintViolation</strong></span> . The
      <span class="command"><strong>@NotNull</strong></span> constraints of <span class="command"><strong>firstName</strong></span>
      and <span class="command"><strong>lastName</strong></span> are ignored since they are associated
      with <span class="command"><strong>profile1</strong></span> and <span class="command"><strong>profile1</strong></span> has
      been disabled.</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e571"></a>8.2.&nbsp;Collection factory</h3></div></div></div>
      

      <p>OVal instantiates all internally used collections indirectly via a
      <span class="command"><strong>CollectionFactory</strong></span> . OVal comes with three different
      implementations of the collection factory (Javolution Collections, GNU
      Trove Collections, and JDK Collections). If the Javolution or GNU Trove
      collection classes are detected in the classpath, OVal automatically
      uses the respective CollectionFactory otherwise the collection factory
      for standard JDK collections is used.</p>

      <p>The Collection Factory to be used by OVal can be configured via
      the static <span class="command"><strong>Validator.setCollectionFactory(factory)</strong></span>
      method.</p>

      <p>You can implement the
      <span class="command"><strong>net.sf.oval.collection.CollectionFactory</strong></span> interface to
      support other collection implementations.</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e579"></a>8.3.&nbsp;Adding additional expression languages</h3></div></div></div>
      

      <p>If you want to express constraints in a scripting language not
      supported by OVal out of the box, you need to implement the
      <span class="command"><strong>net.sf.oval.expression.ExpressionLanguage</strong></span> interface
      for the desired language and register your implementation with OVal
      using the <span class="command"><strong>Validator.addExpressionLanguage(languageId,
      expressionLanguage)</strong></span> method. Then you can use the specified
      languageId with expression language aware constraint annotations such as
      <span class="command"><strong>@Assert</strong></span>, <span class="command"><strong>@Pre</strong></span>, or
      <span class="command"><strong>@Post</strong></span> and start expressing constraints in the new
      expression language.</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e587"></a>8.4.&nbsp;Spring integration</h3></div></div></div>
      

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e589"></a>8.4.1.&nbsp;Spring Validation</h4></div></div></div>
        

        <p>The class
        <span class="command"><strong>net.sf.oval.integration.spring.SpringValidator</strong></span> OVal
        provides an implementation of Spring's
        <span class="command"><strong>org.springframework.validation.Validator</strong></span> interface
        and thus can be used for <a class="ulink" href="http://static.springframework.org/spring/docs/2.5.x/reference/validation.html" target="'_self'">Spring
        Validation</a>.</p>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e595"></a>8.4.2.&nbsp;Guarding Spring managed beans using Spring AOP</h4></div></div></div>
        

        <p>It is possible to use OVal's programming by contract feature
        with AOP solutions other than AspectJ. Spring for example uses the AOP
        Alliance API in conjunction with JDK or CGLib proxies to provide
        certain features of AOP to Spring managed beans.</p>

        <p>With the class
        <span class="command"><strong>net.sf.oval.guard.GuardInterceptor</strong></span> we provide an
        AOP Alliance implementation of the Guard aspect that enables you to
        use OVal's guarding feature in conjunction with Spring managed beans
        without the need for AspectJ.</p>

        <p>Here is an example how to configure the guarding of the methods
        of a Spring managed service. This configuration requires CGLIB to be
        on the classpath.</p>

        <pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">beans</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">bean</b> <span class="hl-attribute" style="color: blue">id</span>=<span class="hl-value" style="color: blue">"myService"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"MyServiceImpl"</span> /&gt;

  &lt;<b class="hl-tag" style="color: blue">bean</b> <span class="hl-attribute" style="color: blue">id</span>=<span class="hl-value" style="color: blue">"ovalGuardInterceptor"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"net.sf.oval.guard.GuardInterceptor"</span> /&gt;

  &lt;<b class="hl-tag" style="color: blue">bean</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">property</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"proxyTargetClass"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"true"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">property</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"beanNames"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"*Service"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">property</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"interceptorNames"</span>&gt;&lt;<b class="hl-tag" style="color: blue">list</b>&gt;&lt;<b class="hl-tag" style="color: blue">value</b>&gt;ovalGuardInterceptor&lt;<b class="hl-tag" style="color: blue">/value</b>&gt;&lt;<b class="hl-tag" style="color: blue">/list</b>&gt;&lt;<b class="hl-tag" style="color: blue">/property</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/bean</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/beans</b>&gt;
</pre>
      </div>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e602"></a>8.5.&nbsp;Apache Struts 2 integration</h3></div></div></div>
      

      <p>Musachy Barroso has developed an OVal Plug-in for Apache Struts 2,
      which is documented at <a class="ulink" href="http://cwiki.apache.org/confluence/display/S2PLUGINS/OVal+Plugin" target="'_self'">http://cwiki.apache.org/confluence/display/S2PLUGINS/OVal+Plugin
      </a></p>
    </div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e606"></a>9.&nbsp;API documentation</h2></div></div></div>
    

    <p>You can browse OVal's Javadoc <a class="ulink" href="api/index.html" target="'_self'">here</a> .</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e610"></a>10.&nbsp;Download</h2></div></div></div>
    

    <p>You can download the latest OVal binaries and source code from the
    project page at <a class="ulink" href="http://sourceforge.net/projects/oval/" target="'_self'">http://sourceforge.net/projects/oval/</a></p>

    <p></p>

    <p><a class="ulink" href="http://www.sourceforge.net/" target="'_self'"> <span class="inlinemediaobject"><img src="images/sourceforge.png"></span> </a> <a class="ulink" href="http://www.junit.org/" target="'_self'">
    <span class="inlinemediaobject"><img src="images/junit.png"></span> </a> <a class="ulink" href="http://www.eclipse.org/aspectj/" target="'_self'"> <span class="inlinemediaobject"><img src="images/aspectj.png"></span> </a> <a class="ulink" href="http://javolution.org/" target="'_self'">
    <span class="inlinemediaobject"><img src="images/javolution.png"></span> </a> <a class="ulink" href="http://xstream.codehaus.org/" target="'_self'">
    <span class="inlinemediaobject"><img src="images/xstream.png"></span> </a> <a class="ulink" href="http://www.mozilla.org/rhino/" target="'_self'"> <span class="inlinemediaobject"><img src="images/rhino.png"></span> </a> <a class="ulink" href="http://groovy.codehaus.org/" target="'_self'">
    <span class="inlinemediaobject"><img src="images/groovy.png"></span> </a> <a class="ulink" href="http://paranamer.codehaus.org/" target="'_self'"> <span class="inlinemediaobject"><img src="images/paranamer.png"></span> </a> <a class="ulink" href="http://www.ognl.org/" target="'_self'">
    <span class="inlinemediaobject"><img src="images/ognl.png"></span> </a> <a class="ulink" href="http://mvel.codehaus.org/" target="'_self'">
    <span class="inlinemediaobject"><img src="images/mvel.png"></span> </a></p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e656"></a>11.&nbsp;References</h2></div></div></div>
    

    <p>There exist some articles and blog entries talking about and/or
    referencing OVal:</p>

    <div class="itemizedlist"><ul type="disc"><li>
        <p>Dise&ntilde;o por Contrato con OVal y Spring [Design by Contract with OVal and Spring] (2009)</p>

        <p><a class="ulink" href="http://www.dosideas.com/java/562-diseno-por-contrato-con-oval-y-spring.html" target="'_self'">http://www.dosideas.com/java/562-diseno-por-contrato-con-oval-y-spring.html</a></p>
        <p><a class="ulink" href="http://translate.google.com/translate?u=http%3A%2F%2Fwww.dosideas.com%2Fjava%2F562-diseno-por-contrato-con-oval-y-spring.html&amp;sl=es&amp;tl=en" target="'_self'">English Translation</a></p>
      </li><li>
        <p>OVal Blog Entry Series at the "JEE, BPEL, SOA" blog
        (2008)</p>

        <p><a class="ulink" href="http://jee-bpel-soa.blogspot.com/2008/12/jsr-303-and-oval-validation-framework.html" target="'_self'">JSR
        303 and OVal Validation Framework</a></p>

        <p><a class="ulink" href="http://jee-bpel-soa.blogspot.com/2008/12/oval-and-profiles.html" target="'_self'">OVal
        and profiles</a></p>

        <p><a class="ulink" href="http://jee-bpel-soa.blogspot.com/2008/12/springs-piecemeal-validation-and-oval.html" target="'_self'">Spring's
        piecemeal validation and OVal integration</a></p>
      </li><li>
        <p>Pre and post condition validation with OVal as intruments of
        software architecture (2008)</p>

        <p><a class="ulink" href="http://stigl.wordpress.com/2008/07/19/pre-and-post-condition-validation-with-oval-as-intruments-of-software-architecture/" target="'_self'">
        http://stigl.wordpress.com/2008/07/19/pre-and-post-condition-validation-with-oval-as-intruments-of-software-architecture/
        </a></p>
      </li><li>
        <p>OVal: The simple validation framework for Java (2008)</p>

        <p><a class="ulink" href="http://takezoe.blogspot.com/2008/03/oval-simple-validation-framework-for.html" target="'_self'">
        http://takezoe.blogspot.com/2008/03/oval-simple-validation-framework-for.html
        </a></p>
      </li><li>
        <p>Validaci&oacute;n Java: OVal, una joya escondida (2007)</p>

        <p><a class="ulink" href="http://brigomp.blogspot.com/2007/09/hay-veces-que-los-frameworks-menos.html" target="'_self'">
        http://brigomp.blogspot.com/2007/09/hay-veces-que-los-frameworks-menos.html
        </a></p>
      </li><li>
        <p>Die Pro-Pix Homepage - Design by Contract (2007)</p>

        <p><a class="ulink" href="http://pro-pix.de/joomla/index.php?option=com_content&amp;task=view&amp;id=39&amp;Itemid=1" target="'_self'">
        http://pro-pix.de/joomla/index.php?option=com_content&amp;task=view&amp;id=39&amp;Itemid=1
        </a></p>
      </li><li>
        <p>Nice library for constraint checking (2007)</p>

        <p><a class="ulink" href="http://rmeindl.wordpress.com/2007/09/06/nice-library-for-constraint-checking/" target="'_self'">
        http://rmeindl.wordpress.com/2007/09/06/nice-library-for-constraint-checking/
        </a></p>
      </li><li>
        <p>Validation with Aspects &amp; design by contract (2007)</p>

        <p><a class="ulink" href="http://sameertyagi.blogspot.com/2007/05/validation-with-aspects-and-contracts_20.html" target="'_self'">
        http://sameertyagi.blogspot.com/2007/05/validation-with-aspects-and-contracts_20.html
        </a></p>
      </li><li>
        <p>In pursuit of code quality: Defensive programming with AOP
        (2007)</p>

        <p><a class="ulink" href="http://www-128.ibm.com/developerworks/java/library/j-cq01307/" target="'_self'">
        http://www-128.ibm.com/developerworks/java/library/j-cq01307/
        </a></p>
      </li><li>
        <p>OVal e la validazione degli oggetti in Java (2006)</p>

        <p><a class="ulink" href="http://www.keepintech.it/blog/?p=52" target="'_self'">http://www.keepintech.it/blog/?p=52</a></p>
      </li><li>
        <p>Limiting conditional complexity with AOP (2006)</p>

        <p><a class="ulink" href="http://testearly.findtechblogs.com/default.asp?item=412603" target="'_self'">
        http://testearly.findtechblogs.com/default.asp?item=412603
        </a></p>

        <p><a class="ulink" href="http://www.nofluffjuststuff.com/blog_detail.jsp?rssItemId=98236" target="'_self'">
        http://www.nofluffjuststuff.com/blog_detail.jsp?rssItemId=98236
        </a></p>

        <p><a class="ulink" href="http://www.testearly.com/2006/12/31/limiting-conditional-complexity-with-aop/" target="'_self'">
        http://www.testearly.com/2006/12/31/limiting-conditional-complexity-with-aop/
        </a></p>
      </li><li>
        <p>Metadata and AOP (2005)</p>

        <p><a class="ulink" href="http://www2.java.no/web/files/moter/nov05/yngvar_sorensen_metadata_and_aop.pdf" target="'_self'">
        http://www2.java.no/web/files/moter/nov05/yngvar_sorensen_metadata_and_aop.pdf
        </a></p>
      </li></ul></div>

    <p>The following projects are using OVal:</p>

    <div class="itemizedlist"><ul type="disc"><li>
        <p>Cubby Simple Web Application Framework</p>

        <p><a class="ulink" href="http://cubby.seasar.org/20x/cubby-oval/index.html" target="'_self'">http://cubby.seasar.org/20x/cubby-oval/index.html</a></p>
      </li><li>
        <p>Metawidget</p>

        <p><a class="ulink" href="http://metawidget.org" target="'_self'">http://metawidget.org</a></p>
      </li><li>
        <p>Struts 2 OVal Plug-in</p>

        <p><a class="ulink" href="http://cwiki.apache.org/confluence/display/S2PLUGINS/OVal+Plugin" target="'_self'">http://cwiki.apache.org/confluence/display/S2PLUGINS/OVal+Plugin
        </a></p>
      </li><li>
        <p>Play! Framework</p>

        <p><a class="ulink" href="http://www.playframework.org/" target="'_self'">http://www.playframework.org/
        </a></p>
      </li><li>
        <p>Cayenne annotations</p>

        <p><a class="ulink" href="http://sourceforge.net/projects/cayannotations/" target="'_self'">http://sourceforge.net/projects/cayannotations/
        </a></p>
      </li><li>
        <p>jsfatwork</p>

        <p><a class="ulink" href="http://code.google.com/p/jsfatwork/" target="'_self'">http://code.google.com/p/jsfatwork/</a></p>
      </li><li>
        <p>mtn4java</p>

        <p><a class="ulink" href="http://www.mvnrepository.com/artifact/org.criticalsection.mtn4java/mtn4java/" target="'_self'">http://www.mvnrepository.com/artifact/org.criticalsection.mtn4java/mtn4java/</a></p>
      </li><li>
        <p>Polyforms</p>

        <p><a class="ulink" href="http://code.google.com/p/polyforms/" target="'_self'">http://code.google.com/p/polyforms/</a></p>
      </li><li>
        <p>rsser</p>

        <p><a class="ulink" href="http://code.google.com/p/rsser/" target="'_self'">http://code.google.com/p/rsser/</a></p>
      </li><li>
        <p>saetc</p>

        <p><a class="ulink" href="http://code.google.com/p/saetc/" target="'_self'">http://code.google.com/p/saetc/</a></p>
      </li><li>
        <p>ultimate-roundtrip</p>

        <p><a class="ulink" href="http://code.google.com/p/ultimate-roundtrip/" target="'_self'">http://code.google.com/p/ultimate-roundtrip/</a></p>
      </li></ul></div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e764"></a>12.&nbsp;Acknowledgements</h2></div></div></div>
    

    <p>YourKit is kindly supporting open source projects with its
    full-featured Java Profiler.</p>

    <p>YourKit, LLC is creator of innovative and intelligent tools for
    profiling Java and .NET applications. Take a look at YourKit's leading
    software products: <a class="ulink" href="http://www.yourkit.com/java/profiler/" target="'_self'">YourKit Java Profiler</a>
    and <a class="ulink" href="http://www.yourkit.com/.net/profiler/" target="'_self'">YourKit .NET
    Profiler</a>.</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e770"></a>13.&nbsp;Trademark disclaimer</h2></div></div></div>
    

    <p><span class="trademark">Java</span>&#8482; and all Java-based trademarks are
    trademarks of Sun Microsystems, Inc. in the United States, other
    countries, or both. For more information please refer to: <a class="ulink" href="http://www.sun.com/policies/trademarks/" target="'_self'">http://www.sun.com/policies/trademarks/</a></p>

    <p>This site is independent of Sun Microsystems, Inc.</p>

    <p>All other trademarks are the sole property of their respective
    owners.</p>

    <p><a class="ulink" href="http://docbook.sourceforge.net/projects/xsl/" target="'_self'">
    <span class="inlinemediaobject"><img src="images/docbook.png"></span> </a></p>
  </div>
</div></body></html>