<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">第20章 Toolset Guide ツールセットガイド</title><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java"/><link rel="up" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java"/><link rel="prev" href="performance.html" title="第19章 パフォーマンスの改善"/><link rel="next" href="example-parentchild.html" title="第21章 例：親/子供"/><link rel="copyright" href="ln-Legal_Notice.html" title="Legal Notice"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="performance.html"><strong>前のページ</strong></a></li><li class="next"><a accesskey="n" href="example-parentchild.html"><strong>次のページ</strong></a></li></ul><div class="chapter" lang="ja-JP"><div class="titlepage"><div><div><h2 class="title"><a id="toolsetguide"/>第20章 Toolset Guide ツールセットガイド</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="toolsetguide.html#toolsetguide-s1">20.1. スキーマの自動生成</a></span></dt><dd><dl><dt><span class="sect2"><a href="toolsetguide.html#toolsetguide-s1-2">20.1.1. スキーマのカスタマイズ</a></span></dt><dt><span class="sect2"><a href="toolsetguide.html#toolsetguide-s1-3">20.1.2. ツールの実行</a></span></dt><dt><span class="sect2"><a href="toolsetguide.html#toolsetguide-s1-4">20.1.3. プロパティ</a></span></dt><dt><span class="sect2"><a href="toolsetguide.html#toolsetguide-s1-5">20.1.4. Antを使用する</a></span></dt><dt><span class="sect2"><a href="toolsetguide.html#toolsetguide-s1-6">20.1.5. インクリメンタルなスキーマ更新</a></span></dt><dt><span class="sect2"><a href="toolsetguide.html#toolsetguide-s1-7">20.1.6. インクリメンタルなスキーマ更新に対するAntの使用</a></span></dt><dt><span class="sect2"><a href="toolsetguide.html#toolsetguide-s1-8">20.1.7. Schema validation</a></span></dt><dt><span class="sect2"><a href="toolsetguide.html#toolsetguide-s1-9">20.1.8. スキーマのバリデーションにAntを使用します</a></span></dt></dl></dd></dl></div><p>Roundtrip engineering with Hibernate is possible using a set of Eclipse plugins, commandline tools, and Ant tasks. </p><p><span class="emphasis"><em>Hibernate Tools</em></span> currently include plugins for the Eclipse IDE as well as Ant tasks for reverse engineering of existing databases: </p><div class="itemizedlist"><ul><li><p><span class="emphasis"><em>Mapping Editor:</em></span> an editor for Hibernate XML mapping files that supports auto-completion and syntax highlighting. It also supports semantic auto-completion for class names and property/field names, making it more versatile than a normal XML editor. </p></li><li><p><span class="emphasis"><em>Console:</em></span> the console is a new view in Eclipse. In addition to a tree overview of your console configurations, you are also provided with an interactive view of your persistent classes and their relationships. The console allows you to execute HQL queries against your database and browse the result directly in Eclipse. </p></li><li><p><span class="emphasis"><em>Development Wizards:</em></span> several wizards are provided with the Hibernate Eclipse tools. You can use a wizard to quickly generate Hibernate configuration (cfg.xml) files, or to reverse engineer an existing database schema into POJO source files and Hibernate mapping files. The reverse engineering wizard supports customizable templates. </p></li><li><p>

        </p></li></ul></div><p>Please refer to the <span class="emphasis"><em>Hibernate Tools</em></span> package documentation for more information. </p><p>However, the Hibernate main package comes bundled with an integrated tool : <span class="emphasis"><em>SchemaExport</em></span> aka <code class="literal">hbm2ddl</code>.It can even be used from "inside" Hibernate. </p><div class="sect1" lang="ja-JP"><div class="titlepage"><div><div><h2 class="title"><a id="toolsetguide-s1"/>20.1. スキーマの自動生成</h2></div></div></div><p>DDL can be generated from your mapping files by a Hibernate utility. The generated schema includes referential integrity constraints, primary and foreign keys, for entity and collection tables. Tables and sequences are also created for mapped identifier generators. </p><p>You <span class="emphasis"><em>must</em></span> specify a SQL <code class="literal">Dialect</code> via the <code class="literal">hibernate.dialect</code> property when using this tool, as DDL is highly vendor-specific. </p><p>First, you must customize your mapping files to improve the generated schema. The next section covers schema customization. </p><div class="sect2" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="toolsetguide-s1-2"/>20.1.1. スキーマのカスタマイズ</h3></div></div></div><p>Many Hibernate mapping elements define optional attributes named <code class="literal">length</code>, <code class="literal">precision</code> and <code class="literal">scale</code>. You can set the length, precision and scale of a column with this attribute. </p><pre class="programlisting">&lt;property name="zip" length="5"/&gt;</pre><pre class="programlisting">&lt;property name="balance" precision="12" scale="2"/&gt;</pre><p>Some tags also accept a <code class="literal">not-null</code> attribute for generating a <code class="literal">NOT NULL</code> constraint on table columns, and a <code class="literal">unique</code> attribute for generating <code class="literal">UNIQUE</code> constraint on table columns. </p><pre class="programlisting">&lt;many-to-one name="bar" column="barId" not-null="true"/&gt;</pre><pre class="programlisting">&lt;element column="serialNumber" type="long" not-null="true" unique="true"/&gt;</pre><p>A <code class="literal">unique-key</code> attribute can be used to group columns in a single, unique key constraint. Currently, the specified value of the <code class="literal">unique-key</code> attribute is <span class="emphasis"><em>not</em></span> used to name the constraint in the generated DDL. It is only used to group the columns in the mapping file. </p><pre class="programlisting">&lt;many-to-one name="org" column="orgId" unique-key="OrgEmployeeId"/&gt;
&lt;property name="employeeId" unique-key="OrgEmployee"/&gt;</pre><p>An <code class="literal">index</code> attribute specifies the name of an index that will be created using the mapped column or columns. Multiple columns can be grouped into the same index by simply specifying the same index name. </p><pre class="programlisting">&lt;property name="lastName" index="CustName"/&gt;
&lt;property name="firstName" index="CustName"/&gt;</pre><p>A <code class="literal">foreign-key</code> attribute can be used to override the name of any generated foreign key constraint. </p><pre class="programlisting">&lt;many-to-one name="bar" column="barId" foreign-key="FKFooBar"/&gt;</pre><p>多くのマッピング要素は、子 <code class="literal">&lt;column&gt;</code> 要素を記述できます。これは複数カラム型のマッピングには特に有用です。 </p><pre class="programlisting">&lt;property name="name" type="my.customtypes.Name"/&gt;
    &lt;column name="last" not-null="true" index="bar_idx" length="30"/&gt;
    &lt;column name="first" not-null="true" index="bar_idx" length="20"/&gt;
    &lt;column name="initial"/&gt;
&lt;/property&gt;</pre><p>The <code class="literal">default</code> attribute allows you to specify a default value for a column.You should assign the same value to the mapped property before saving a new instance of the mapped class. </p><pre class="programlisting">&lt;property name="credits" type="integer" insert="false"&gt;
    &lt;column name="credits" default="10"/&gt;
&lt;/property&gt;</pre><pre class="programlisting">&lt;version name="version" type="integer" insert="false"&gt;
    &lt;column name="version" default="0"/&gt;
&lt;/property&gt;</pre><p><code class="literal">sql-type</code> 属性で、デフォルトのHibernate型からSQLのデータ型へのマッピングをオーバーライドできます。 </p><pre class="programlisting">&lt;property name="balance" type="float"&gt;
    &lt;column name="balance" sql-type="decimal(13,3)"/&gt;
&lt;/property&gt;</pre><p><code class="literal">check</code> 属性でチェック制約を指定することができます。 </p><pre class="programlisting">&lt;property name="foo" type="integer"&gt;
    &lt;column name="foo" check="foo &gt; 10"/&gt;
&lt;/property&gt;</pre><pre class="programlisting">&lt;class name="Foo" table="foos" check="bar &lt; 100.0"&gt;
    ...
    &lt;property name="bar" type="float"/&gt;
&lt;/class&gt;</pre><p>The following table summarizes these optional attributes.</p><div class="table"><a id="schemattributes-summary"/><p class="title"><b>表 20.1. まとめ</b></p><div class="table-contents"><table summary="まとめ" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>属性</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal">length</code></td><td>数値</td><td>カラムの長さ</td></tr><tr><td><code class="literal">precision</code></td><td>数値</td><td>カラムのDECIMAL型の精度（precision）</td></tr><tr><td><code class="literal">scale</code></td><td>数値</td><td>カラムのDECIMAL型のスケール（scale）</td></tr><tr><td><code class="literal">not-null</code></td><td><code class="literal">true|false</code></td><td>specifies that the column should be non-nullable</td></tr><tr><td><code class="literal">unique</code></td><td><code class="literal">true|false</code></td><td>カラムがユニーク制約を持つことを指定します</td></tr><tr><td><code class="literal">index</code></td><td><code class="literal">インデックス名</code></td><td>(複数カラムの)インデックスの名前を指定します</td></tr><tr><td><code class="literal">unique-key</code></td><td><code class="literal">ユニークキー名</code></td><td>複数カラムのユニーク制約の名前を指定します</td></tr><tr><td><code class="literal">foreign-key</code></td><td><code class="literal">外部キー名</code></td><td>specifies the name of the foreign key constraint generated for an association, for a <code class="literal">&lt;one-to-one&gt;</code>, <code class="literal">&lt;many-to-one&gt;</code>, <code class="literal">&lt;key&gt;</code>, or <code class="literal">&lt;many-to-many&gt;</code> mapping element. Note that <code class="literal">inverse="true"</code> sides will not be considered by <code class="literal">SchemaExport</code>. </td></tr><tr><td><code class="literal">sql-type</code></td><td><code class="literal">SQLのカラム型</code></td><td>overrides the default column type (attribute of <code class="literal">&lt;column&gt;</code> element only) </td></tr><tr><td><code class="literal">default</code></td><td>SQL式</td><td>カラムのデフォルト値を指定します </td></tr><tr><td><code class="literal">check</code></td><td>SQL式</td><td>カラムかテーブルにSQLのチェック制約を作成します </td></tr></tbody></table></div></div><br class="table-break"/><p><code class="literal">&lt;comment&gt;</code> 要素で生成するスキーマにコメントを指定することができます。 </p><pre class="programlisting">&lt;class name="Customer" table="CurCust"&gt;
    &lt;comment&gt;Current customers only&lt;/comment&gt;
    ...
&lt;/class&gt;</pre><pre class="programlisting">&lt;property name="balance"&gt;
    &lt;column name="bal"&gt;
        &lt;comment&gt;Balance in USD&lt;/comment&gt;
    &lt;/column&gt;
&lt;/property&gt;</pre><p>This results in a <code class="literal">comment on table</code> or <code class="literal">comment on column</code> statement in the generated DDL where supported. </p></div><div class="sect2" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="toolsetguide-s1-3"/>20.1.2. ツールの実行</h3></div></div></div><p><code class="literal">SchemaExport</code> は標準出力に対してDDLスクリプトを書き出し、DDL文を実行したりもします。 </p><p>The following table displays the <code class="literal">SchemaExport</code> command line options</p><p><code class="literal">java -cp </code><span class="emphasis"><em>hibernate_classpaths</em></span> <code class="literal">org.hibernate.tool.hbm2ddl.SchemaExport</code> <span class="emphasis"><em>options mapping_files</em></span> </p><div class="table"><a id="d0e15657"/><p class="title"><b>表 20.2. <code class="literal">SchemaExport</code> Command Line Options <code class="literal">SchemaExport</code> のコマンドラインオプション</b></p><div class="table-contents"><table summary="SchemaExport Command Line Options SchemaExport のコマンドラインオプション" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>オプション</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal">--quiet</code></td><td>do not output the script to stdout</td></tr><tr><td><code class="literal">--drop</code></td><td>テーブルの削除だけを行います</td></tr><tr><td><code class="literal">--create</code></td><td>テーブルの生成のみを行います。</td></tr><tr><td><code class="literal">--text</code></td><td>do not export to the database</td></tr><tr><td><code class="literal">--output=my_schema.ddl</code></td><td>DDLスクリプトをファイルに出力します</td></tr><tr><td><code class="literal">--naming=eg.MyNamingStrategy</code></td><td>select a <code class="literal">NamingStrategy</code></td></tr><tr><td><code class="literal">--config=hibernate.cfg.xml</code></td><td>XMLファイルからHibernateの定義情報を読み込みます</td></tr><tr><td><code class="literal">--properties=hibernate.properties</code></td><td>read database properties from a file</td></tr><tr><td><code class="literal">--format</code></td><td>スクリプト内に生成するSQLを読みやすいようにフォーマットします</td></tr><tr><td><code class="literal">--delimiter=x</code></td><td>スクリプトの行区切り文字を設定します</td></tr></tbody></table></div></div><br class="table-break"/><p>You can even embed <code class="literal">SchemaExport</code> in your application: </p><pre class="programlisting">Configuration cfg = ....;
new SchemaExport(cfg).create(false, true);</pre></div><div class="sect2" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="toolsetguide-s1-4"/>20.1.3. プロパティ</h3></div></div></div><p>Database properties can be specified: </p><div class="itemizedlist"><ul compact="compact"><li><p><code class="literal">-D</code><span class="emphasis"><em>&lt;property&gt;</em></span> を使って、システムプロパティとして</p></li><li><p><code class="literal">hibernate.properties</code> ファイル内で</p></li><li><p><code class="literal">--properties</code> を使って指定したプロパティファイル内で</p></li></ul></div><p>必要なプロパティは以下のものです： </p><div class="table"><a id="d0e15769"/><p class="title"><b>表 20.3. SchemaExportコネクションプロパティ</b></p><div class="table-contents"><table summary="SchemaExportコネクションプロパティ" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>プロパティ名</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal">hibernate.connection.driver_class</code></td><td>jdbcのドライバークラス</td></tr><tr><td><code class="literal">hibernate.connection.url</code></td><td>jdbcのurl</td></tr><tr><td><code class="literal">hibernate.connection.username</code></td><td>データベースのユーザ</td></tr><tr><td><code class="literal">hibernate.connection.password</code></td><td>ユーザパスワード</td></tr><tr><td><code class="literal">hibernate.dialect</code></td><td>データベース方言</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="toolsetguide-s1-5"/>20.1.4. Antを使用する</h3></div></div></div><p>Antのビルドスクリプトから <code class="literal">SchemaExport</code> を呼び出すことができます。: </p><pre class="programlisting">&lt;target name="schemaexport"&gt;
    &lt;taskdef name="schemaexport"
        classname="org.hibernate.tool.hbm2ddl.SchemaExportTask"
        classpathref="class.path"/&gt;
    
    &lt;schemaexport
        properties="hibernate.properties"
        quiet="no"
        text="no"
        drop="no"
        delimiter=";"
        output="schema-export.sql"&gt;
        &lt;fileset dir="src"&gt;
            &lt;include name="**/*.hbm.xml"/&gt;
        &lt;/fileset&gt;
    &lt;/schemaexport&gt;
&lt;/target&gt;</pre></div><div class="sect2" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="toolsetguide-s1-6"/>20.1.5. インクリメンタルなスキーマ更新</h3></div></div></div><p>The <code class="literal">SchemaUpdate</code> tool will update an existing schema with "incremental" changes. The <code class="literal">SchemaUpdate</code> depends upon the JDBC metadata API and, as such, will not work with all JDBC drivers. </p><p><code class="literal">java -cp </code><span class="emphasis"><em>hibernate_classpaths</em></span> <code class="literal">org.hibernate.tool.hbm2ddl.SchemaUpdate</code> <span class="emphasis"><em>options mapping_files</em></span> </p><div class="table"><a id="d0e15845"/><p class="title"><b>表 20.4. <code class="literal">SchemaUpdate</code> のコマンドライン･オプション</b></p><div class="table-contents"><table summary="SchemaUpdate のコマンドライン･オプション" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>オプション</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal">--quiet</code></td><td>do not output the script to stdout</td></tr><tr><td><code class="literal">--text</code></td><td>do not export the script to the database</td></tr><tr><td><code class="literal">--naming=eg.MyNamingStrategy</code></td><td>select a <code class="literal">NamingStrategy</code></td></tr><tr><td><code class="literal">--properties=hibernate.properties</code></td><td>read database properties from a file</td></tr><tr><td><code class="literal">--config=hibernate.cfg.xml</code></td><td>specify a <code class="literal">.cfg.xml</code> file</td></tr></tbody></table></div></div><br class="table-break"/><p>You can embed <code class="literal">SchemaUpdate</code> in your application: </p><pre class="programlisting">Configuration cfg = ....;
new SchemaUpdate(cfg).execute(false);</pre></div><div class="sect2" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="toolsetguide-s1-7"/>20.1.6. インクリメンタルなスキーマ更新に対するAntの使用</h3></div></div></div><p>Antスクリプトから <code class="literal">SchemaUpdate</code> を呼び出すことができます： </p><pre class="programlisting">&lt;target name="schemaupdate"&gt;
    &lt;taskdef name="schemaupdate"
        classname="org.hibernate.tool.hbm2ddl.SchemaUpdateTask"
        classpathref="class.path"/&gt;
    
    &lt;schemaupdate
        properties="hibernate.properties"
        quiet="no"&gt;
        &lt;fileset dir="src"&gt;
            &lt;include name="**/*.hbm.xml"/&gt;
        &lt;/fileset&gt;
    &lt;/schemaupdate&gt;
&lt;/target&gt;</pre></div><div class="sect2" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="toolsetguide-s1-8"/>20.1.7. Schema validation</h3></div></div></div><p>The <code class="literal">SchemaValidator</code> tool will validate that the existing database schema "matches" your mapping documents. The <code class="literal">SchemaValidator</code> depends heavily upon the JDBC metadata API and, as such, will not work with all JDBC drivers. This tool is extremely useful for testing. </p><p><code class="literal">java -cp </code><span class="emphasis"><em>hibernate_classpaths</em></span> <code class="literal">org.hibernate.tool.hbm2ddl.SchemaValidator</code> <span class="emphasis"><em>options mapping_files</em></span> </p><div class="table"><a id="d0e15935"/><p class="title"><b>表 20.5. <code class="literal">SchemaValidator</code> のコマンドライン・オプション</b></p><div class="table-contents"><table summary="SchemaValidator のコマンドライン・オプション" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>オプション</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal">--naming=eg.MyNamingStrategy</code></td><td>select a <code class="literal">NamingStrategy</code></td></tr><tr><td><code class="literal">--properties=hibernate.properties</code></td><td>read database properties from a file</td></tr><tr><td><code class="literal">--config=hibernate.cfg.xml</code></td><td>specify a <code class="literal">.cfg.xml</code> file</td></tr></tbody></table></div></div><br class="table-break"/><p>You can embed <code class="literal">SchemaValidator</code> in your application: </p><pre class="programlisting">Configuration cfg = ....;
new SchemaValidator(cfg).validate();</pre></div><div class="sect2" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="toolsetguide-s1-9"/>20.1.8. スキーマのバリデーションにAntを使用します</h3></div></div></div><p>Antスクリプトから <code class="literal">SchemaValidator</code> を呼び出せます: </p><pre class="programlisting">&lt;target name="schemavalidate"&gt;
    &lt;taskdef name="schemavalidator"
        classname="org.hibernate.tool.hbm2ddl.SchemaValidatorTask"
        classpathref="class.path"/&gt;
    
    &lt;schemavalidator
        properties="hibernate.properties"&gt;
        &lt;fileset dir="src"&gt;
            &lt;include name="**/*.hbm.xml"/&gt;
        &lt;/fileset&gt;
    &lt;/schemavalidator&gt;
&lt;/target&gt;</pre></div></div></div><HR xmlns=""/><a xmlns="" href="legalnotice.html"><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">製作著作 © 2004 Red Hat Middleware, LLC.</p></a><ul class="docnav"><li class="previous"><a accesskey="p" href="performance.html"><strong>前のページ</strong>第19章 パフォーマンスの改善</a></li><li class="up"><a accesskey="u" href="#"><strong>上に戻る</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>ホーム</strong></a></li><li class="next"><a accesskey="n" href="example-parentchild.html"><strong>次のページ</strong>第21章 例：親/子供</a></li></ul></body></html>