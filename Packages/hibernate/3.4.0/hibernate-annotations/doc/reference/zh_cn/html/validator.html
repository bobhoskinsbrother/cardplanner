<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;4&nbsp;&#31456;&nbsp;Hibernate&#39564;&#35777;&#22120;</title><link rel="stylesheet" href="../shared/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Hibernate Annotations"><link rel="up" href="index.html" title="Hibernate Annotations"><link rel="previous" href="xml-overriding.html" title="&#31532;&nbsp;3&nbsp;&#31456;&nbsp;&#36890;&#36807;XML&#35206;&#20889;&#20803;&#25968;&#25454;"><link rel="next" href="lucene.html" title="&#31532;&nbsp;5&nbsp;&#31456;&nbsp;Hibernate&#19982;Lucene&#38598;&#25104;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;4&nbsp;&#31456;&nbsp;Hibernate&#39564;&#35777;&#22120;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="xml-overriding.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="lucene.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title"><a name="validator"></a>&#31532;&nbsp;4&nbsp;&#31456;&nbsp;Hibernate&#39564;&#35777;&#22120;</h2></div></div><div></div></div><p>&#27880;&#35299;&#26159;&#19968;&#31181;&#20026;&#39046;&#22495;&#27169;&#22411;(domain model)&#25351;&#23450;&#19981;&#21464;&#32422;&#26463;&#30340;&#31616;&#27905;&#32780;&#24189;&#38597;&#30340;&#26041;&#27861;&#12290;&#20363;&#22914;&#65292;&#20320;&#33021;
  &#34920;&#31034;&#19968;&#20010;&#23646;&#24615;&#27704;&#36828;&#19981;&#20026;null&#65292;&#19968;&#20010;&#24080;&#25143;&#20313;&#39069;&#19968;&#23450;&#26159;&#27491;&#20540;&#65292;&#31561;&#31561;&#12290;&#36825;&#20123;&#22495;&#27169;&#22411;&#32422;&#26463;&#36890;&#36807;&#20026;bean&#20013;&#30340;&#23646;&#24615;&#28155;&#21152;
  &#27880;&#35299;&#26469;&#21152;&#20197;&#22768;&#26126;&#12290;&#38543;&#21518;&#19968;&#20010;&#39564;&#35777;&#22120;(validator)&#20250;&#35835;&#21462;&#24182;&#26816;&#26597;&#36825;&#20123;&#32422;&#26463;&#12290;&#39564;&#35777;&#26426;&#21046;&#21487;&#20197;&#25191;&#34892;&#20110;&#24212;&#29992;&#31243;&#24207;&#20013;&#30340;
  &#19981;&#21516;&#23618;&#65288;&#34920;&#29616;&#23618;&#12289;&#25968;&#25454;&#35775;&#38382;&#23618;&#65289;&#65292;&#32780;&#19981;&#24517;&#22797;&#36848;&#20219;&#20309;&#65288;&#21069;&#36848;&#65289;&#36825;&#20123;&#35268;&#21017;&#12290;Hibernate&#39564;&#35777;&#22120;&#27491;&#20026;&#36825;&#19968;&#30446;&#30340;&#32780;&#35774;&#35745;&#30340;&#12290;</p><p>Hibernate&#39564;&#35777;&#22120;&#24037;&#20316;&#22312;&#20004;&#20010;&#23618;&#27425;&#19978;&#12290;&#31532;&#19968;&#23618;&#65292;&#23427;&#33021;&#26816;&#26597;&#20869;&#23384;&#20013;&#19968;&#20010;&#31867;&#30340;&#23454;&#20363;&#26159;&#21542;&#36829;&#21453;&#32422;&#26463;&#12290;
  &#31532;&#20108;&#23618;&#65292;&#23427;&#33021;&#23558;&#32422;&#26463;&#24212;&#29992;&#20110;Hibernate&#20803;&#27169;&#22411;&#19978;&#65292;&#24182;&#23558;&#23427;&#20204;&#34701;&#20837;&#29983;&#25104;&#30340;&#25968;&#25454;&#24211;schema&#20013;&#12290;</p><p>&#27599;&#20010;&#32422;&#26463;&#27880;&#35299;&#65288;constraint annotation&#65289;&#21644;&#19968;&#20010;&#39564;&#35777;&#22120;&#23454;&#29616;&#20851;&#32852;&#65292;&#35813;&#39564;&#35777;&#22120;&#36127;&#36131;&#26816;&#26597;&#20301;&#20110;&#23454;&#20307;&#23454;&#20363;&#19978;&#30340;&#32422;&#26463;&#12290;
  &#19968;&#20010;&#39564;&#35777;&#22120;&#20063;&#33021;(&#21487;&#36873;&#22320;)&#23558;&#32422;&#26463;&#24212;&#29992;&#20110;Hibernate&#20803;&#27169;&#22411;&#19978;&#65292;&#35753;Hibernate&#29983;&#25104;&#34920;&#31034;&#36825;&#19968;&#32422;&#26463;&#30340;DDL&#12290;&#20351;&#29992;&#21512;&#36866;&#30340;&#20107;&#20214;&#30417;&#21548;&#22120;&#65292;&#20320;&#33021;
  &#35753;Hibernate&#22312;&#25554;&#20837;&#21644;&#26356;&#26032;&#26102;&#25191;&#34892;&#26816;&#26597;&#25805;&#20316;&#12290;Hibernate&#39564;&#35777;&#22120;&#24182;&#19981;&#23616;&#38480;&#20110;&#21516;Hibernate&#19968;&#36215;&#20351;&#29992;&#12290;
  &#20320;&#33021;&#22312;&#20320;&#24212;&#29992;&#31243;&#24207;&#30340;&#20219;&#20309;&#22320;&#26041;&#26041;&#20415;&#22320;&#20351;&#29992;&#23427;&#12290;</p><p>&#22312;&#36816;&#34892;&#26102;&#26816;&#26597;&#23454;&#20363;&#26102;&#65292;Hibernate&#39564;&#35777;&#22120;&#36820;&#22238;&#36829;&#21453;&#32422;&#26463;&#30340;&#20449;&#24687;&#65292;
  &#36825;&#20123;&#20449;&#24687;&#20197;&#19968;&#20010;<tt class="classname">InvalidValue</tt>&#25968;&#32452;&#30340;&#24418;&#24335;&#36820;&#22238;&#12290;
  &#38500;&#20102;&#20247;&#22810;&#20854;&#20182;&#20449;&#24687;&#22806;&#65292;<tt class="classname">InvalidValue</tt>&#21253;&#21547;&#20102;&#19968;&#20010;&#38169;&#35823;&#25551;&#36848;&#28040;
  &#24687;&#65292;&#35813;&#20449;&#24687;&#21487;&#20197;&#20869;&#23884;&#19982;&#27880;&#35299;&#30456;&#25414;&#32465;&#30340;&#21442;&#25968;&#20540;&#65288;&#20363;&#22914;&#38271;&#24230;&#38480;&#21046;&#65289;&#65292;&#20197;&#21450;&#33021;&#34987;&#25552;&#21462;&#33267;ResourceBundle&#30340;&#28040;&#24687;&#23383;&#20018;&#12290;</p><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validator-constraints"></a>4.1.&nbsp;&#32422;&#26463;</h2></div></div><div></div></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3043"></a>4.1.1.&nbsp;&#20160;&#20040;&#26159;&#32422;&#26463;&#65311;</h3></div></div><div></div></div><p>&#32422;&#26463;&#36890;&#36807;&#27880;&#35299;&#34920;&#31034;&#12290;&#19968;&#20010;&#32422;&#26463;&#36890;&#24120;&#26377;&#19968;&#20123;&#29992;&#26469;&#21442;&#25968;&#21270;&#32422;&#26463;&#38480;&#21046;&#30340;&#23646;&#24615;&#12290;&#32422;&#26463;&#24212;&#29992;&#20110;&#24102;&#27880;&#35299;&#30340;&#20803;&#32032;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3048"></a>4.1.2.&nbsp;&#20869;&#24314;&#32422;&#26463;</h3></div></div><div></div></div><p>Hibernate&#39564;&#35777;&#22120;&#26377;&#20123;&#20869;&#24314;&#32422;&#26463;&#65292;&#36825;&#20123;&#32422;&#26463;&#35206;&#30422;&#20102;&#22823;&#22810;&#25968;&#30340;&#22522;&#26412;&#25968;&#25454;&#26816;&#26597;&#12290;&#38543;&#21518;&#25105;&#20204;&#20250;&#30475;&#21040;&#65292;
      &#20320;&#19981;&#24517;&#21463;&#21046;&#20110;&#36825;&#20123;&#20869;&#32622;&#32422;&#26463;&#65292;&#22240;&#20026;&#19968;&#20998;&#38047;&#20869;&#23601;&#21487;&#20197;&#20889;&#20986;&#20320;&#33258;&#24049;&#30340;&#32422;&#26463;&#12290;</p><div class="table"><a name="d0e3053"></a><p class="title"><b>&#34920;&nbsp;4.1.&nbsp;&#20869;&#24314;&#32422;&#26463;</b></p><table summary="&#20869;&#24314;&#32422;&#26463;" border="1"><colgroup><col align="center"><col><col><col></colgroup><thead><tr><th align="center">&#27880;&#35299;</th><th>&#24212;&#29992;&#30446;&#26631;</th><th>&#36816;&#34892;&#26102;&#26816;&#26597;</th><th>Hibernate&#20803;&#25968;&#25454;&#24433;&#21709;</th></tr></thead><tbody><tr><td align="center">@Length(min=, max=)</td><td>&#23646;&#24615;(String)</td><td>&#26816;&#26597;&#23383;&#31526;&#20018;&#38271;&#24230;&#26159;&#21542;&#31526;&#21512;&#33539;&#22260;</td><td>&#21015;&#38271;&#24230;&#20250;&#34987;&#35774;&#21040;&#26368;&#22823;&#20540;</td></tr><tr><td align="center">@Max(value=)</td><td>&#23646;&#24615; (&#20197;numeric&#25110;&#32773;string&#31867;&#22411;&#26469;&#34920;&#31034;&#19968;&#20010;&#25968;&#23383;)</td><td>&#26816;&#26597;&#20540;&#26159;&#21542;&#23567;&#20110;&#25110;&#31561;&#20110;&#26368;&#22823;&#20540;</td><td>&#23545;&#21015;&#22686;&#21152;&#19968;&#20010;&#26816;&#26597;&#32422;&#26463;</td></tr><tr><td align="center">@Min(value=)</td><td>&#23646;&#24615;(&#20197;numeric&#25110;&#32773;string&#31867;&#22411;&#26469;&#34920;&#31034;&#19968;&#20010;&#25968;&#23383;)</td><td>&#26816;&#26597;&#20540;&#26159;&#21542;&#22823;&#20110;&#25110;&#31561;&#20110;&#26368;&#23567;&#20540;</td><td>&#23545;&#21015;&#22686;&#21152;&#19968;&#20010;&#26816;&#26597;&#32422;&#26463;</td></tr><tr><td align="center">@NotNull</td><td>&#23646;&#24615;</td><td>&#26816;&#26597;&#20540;&#26159;&#21542;&#38750;&#31354;(not null)</td><td>&#21015;&#19981;&#20026;&#31354;</td></tr><tr><td align="center">@Past</td><td>&#23646;&#24615;(date&#25110;calendar)</td><td>&#26816;&#26597;&#26085;&#26399;&#26159;&#21542;&#26159;&#36807;&#21435;&#26102;</td><td>&#23545;&#21015;&#22686;&#21152;&#19968;&#20010;&#26816;&#26597;&#32422;&#26463;</td></tr><tr><td align="center">@Future</td><td>&#23646;&#24615; (date &#25110; calendar)</td><td>&#26816;&#26597;&#26085;&#26399;&#26159;&#21542;&#26159;&#23558;&#26469;&#26102;</td><td>&#26080;</td></tr><tr><td align="center">@Pattern(regex="regexp", flag=)</td><td>&#23646;&#24615; (string)</td><td>&#26816;&#26597;&#23646;&#24615;&#26159;&#21542;&#19982;&#32473;&#23450;&#21305;&#37197;&#26631;&#24535;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;&#30456;&#21305;&#37197;(&#35265;<tt class="classname"> 
              java.util.regex.Pattern </tt>)</td><td>&#26080;</td></tr><tr><td align="center">@Range(min=, max=)</td><td>&#23646;&#24615;(&#20197;numeric&#25110;&#32773;string&#31867;&#22411;&#26469;&#34920;&#31034;&#19968;&#20010;&#25968;&#23383;)</td><td>&#26816;&#26597;&#20540;&#26159;&#21542;&#22312;&#26368;&#23567;&#21644;&#26368;&#22823;&#20540;&#20043;&#38388;(&#21253;&#25324;&#20020;&#30028;&#20540;)</td><td>&#23545;&#21015;&#22686;&#21152;&#19968;&#20010;&#26816;&#26597;&#32422;&#26463;</td></tr><tr><td align="center">@Size(min=, max=)</td><td>&#23646;&#24615; (array, collection, map)</td><td>&#26816;&#26597;&#20803;&#32032;&#22823;&#23567;&#26159;&#21542;&#22312;&#26368;&#23567;&#21644;&#26368;&#22823;&#20540;&#20043;&#38388;(&#21253;&#25324;&#20020;&#30028;&#20540;)</td><td>&#26080;</td></tr><tr><td align="center">@AssertFalse</td><td>&#23646;&#24615;</td><td>&#26816;&#26597;&#26041;&#27861;&#30340;&#28436;&#31639;&#32467;&#26524;&#26159;&#21542;&#20026;false(&#23545;&#20197;&#20195;&#30721;&#26041;&#24335;&#32780;&#19981;&#26159;&#27880;&#35299;&#34920;&#31034;&#30340;&#32422;&#26463;&#24456;&#26377;&#29992;)</td><td>&#26080;</td></tr><tr><td align="center">@AssertTrue</td><td>&#23646;&#24615;</td><td>&#26816;&#26597;&#26041;&#27861;&#30340;&#28436;&#31639;&#32467;&#26524;&#26159;&#21542;&#20026;true(&#23545;&#20197;&#20195;&#30721;&#26041;&#24335;&#32780;&#19981;&#26159;&#27880;&#35299;&#34920;&#31034;&#30340;&#32422;&#26463;&#24456;&#26377;&#29992;)</td><td>&#26080;</td></tr><tr><td align="center">@Valid</td><td>&#23646;&#24615; (object)</td><td>&#23545;&#20851;&#32852;&#23545;&#35937;&#36882;&#24402;&#30340;&#36827;&#34892;&#39564;&#35777;&#12290;&#22914;&#26524;&#23545;&#35937;&#26159;&#38598;&#21512;&#25110;&#25968;&#32452;&#65292;&#23601;&#36882;&#24402;&#22320;&#39564;&#35777;&#20854;&#20803;&#32032;&#12290;&#22914;&#26524;&#23545;&#35937;&#26159;Map&#65292;&#21017;&#36882;&#24402;&#39564;&#35777;&#20854;&#20540;&#20803;&#32032;&#12290;</td><td>&#26080;</td></tr><tr><td align="center">@Email</td><td>&#23646;&#24615;&#65288;String&#65289;</td><td>&#26816;&#26597;&#23383;&#31526;&#20018;&#26159;&#21542;&#31526;&#21512;&#26377;&#25928;&#30340;email&#22320;&#22336;&#35268;&#33539;&#12290;</td><td>&#26080;</td></tr></tbody></table></div></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="validator-constraints-error"></a>4.1.3.&nbsp;&#38169;&#35823;&#20449;&#24687;</h3></div></div><div></div></div><p>Hibernate&#39564;&#35777;&#22120;&#25552;&#20379;&#20102;&#19968;&#32452;&#40664;&#35748;&#30340;&#38169;&#35823;&#25552;&#31034;&#20449;&#24687;&#65292;&#23427;&#20204;&#34987;&#32763;&#35793;&#25104;&#22810;&#31181;&#35821;&#35328;(&#22914;&#26524;&#20320;&#30340;&#35821;&#35328;&#19981;&#22312;&#20854;&#20013;&#65292;&#35831;&#32473;
      &#25105;&#20204;&#23492;&#19968;&#20010;&#34917;&#19969;)&#12290;&#20320;&#21487;&#20197;&#22312;<tt class="filename">org.hibernate.validator.resources.DefaultValidatorMessages.properties</tt>
      &#20043;&#22806;&#21019;&#24314;<tt class="filename">ValidatorMessages.properties</tt>&#25110;<tt class="filename">ValidatorMessages_loc.properties</tt>
      &#25991;&#20214;&#24182;&#25913;&#21464;&#30456;&#24212;&#30340;&#38190;&#20540;&#65292;&#31821;&#27492;&#35206;&#30422;&#37027;&#20123;&#65288;&#40664;&#35748;&#65289;&#20449;&#24687;&#12290;&#20320;&#29978;&#33267;&#21487;&#20197;&#22312;&#20889;&#33258;&#24049;&#30340;&#39564;&#35777;&#22120;
      &#27880;&#35299;&#26102;&#28155;&#21152;&#20320;&#33258;&#24049;&#30340;&#38468;&#21152;&#28040;&#24687;&#38598;&#12290;</p><p>&#25110;&#32773;&#20320;&#21487;&#20197;&#20197;&#32534;&#31243;&#26041;&#24335;&#26816;&#26597;bean&#30340;&#39564;&#35777;&#35268;&#21017;&#24182;&#25552;&#20379;&#30456;&#24212;&#30340;<tt class="classname">ResourceBundle</tt>&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3208"></a>4.1.4.&nbsp;&#32534;&#20889;&#20320;&#33258;&#24049;&#30340;&#32422;&#26463;</h3></div></div><div></div></div><p>&#25193;&#23637;&#20869;&#24314;&#32422;&#26463;&#38598;&#26159;&#26497;&#20854;&#26041;&#20415;&#30340;&#12290;&#20219;&#20309;&#32422;&#26463;&#37117;&#21253;&#25324;&#20004;&#37096;&#20998;&#65306;&#32422;&#26463;<span class="emphasis"><em>&#25551;&#36848;&#31526;</em></span>(&#27880;&#35299;)
      &#21644;&#32422;&#26463;<span class="emphasis"><em>&#39564;&#35777;&#22120;</em></span>(&#23454;&#29616;&#31867;)&#12290;&#19979;&#38754;&#26159;&#19968;&#20010;&#31616;&#21333;&#30340;&#29992;&#25143;&#23450;&#20041;&#25551;&#36848;&#31526;&#65306;</p><pre class="programlisting">@ValidatorClass(CapitalizedValidator.class)
@Target(METHOD) 
@Retention(RUNTIME)
@Documented
public @interface Capitalized {
    CapitalizeType type() default Capitalize.FIRST;
    String message() default "has incorrect capitalization";
}</pre><p><tt class="literal">type</tt>&#21442;&#25968;&#25551;&#36848;&#23646;&#24615;&#24212;&#35813;&#22914;&#20309;&#34987;&#22823;&#20889;&#12290;&#36825;&#26159;&#19968;&#20010;&#23436;&#20840;&#20381;&#36182;&#20110;&#27880;&#35299;&#19994;&#21153;(&#36923;&#36753;)&#30340;&#29992;&#25143;
      &#21442;&#25968;&#12290;</p><p><tt class="literal">message</tt>&#26159;&#29992;&#20110;&#25551;&#36848;&#32422;&#26463;&#36829;&#35268;&#30340;&#40664;&#35748;&#23383;&#31526;&#20018;&#65292;&#23427;&#26159;&#24378;&#21046;&#35201;&#27714;&#30340;&#12290;&#20320;&#21487;&#20197;&#37319;&#21462;&#30828;&#32534;&#30721;&#30340;&#26041;&#24335;&#65292;
      &#25110;&#32773;&#36890;&#36807;Java ResourceBundle&#26426;&#21046;&#23558;message&#30340;&#37096;&#20998;/&#20840;&#37096;&#20869;&#23481;&#25552;&#21462;&#33267;&#22806;&#37096;&#25991;&#20214;&#12290;&#19968;&#26086;&#21457;&#29616;message&#20013;{parameter}&#23383;&#31526;&#20018;&#65292;
      &#23601;&#20250;&#22312;{parameter}&#36825;&#20010;&#20301;&#32622;&#27880;&#20837;&#30456;&#24212;&#30340;&#21442;&#25968;&#20540;(&#22312;&#25105;&#20204;&#30340;&#20363;&#23376;&#37324;Capitalization is not {type}&#20250;&#29983;&#25104; Capitalization is not FIRST)&#65292;
      &#21487;&#20197;&#23558;message&#23545;&#24212;&#30340;&#25972;&#20010;&#23383;&#31526;&#20018;&#25552;&#21462;&#33267;&#22806;&#37096;&#25991;&#20214;ValidatorMessages.properties&#65292;&#36825;&#20063;&#26159;&#19968;&#31181;&#33391;&#22909;&#23454;&#36341;&#12290;
      &#35265;<a href="validator.html#validator-constraints-error">Error messages</a>&#12290;</p><pre class="programlisting">@ValidatorClass(CapitalizedValidator.class)
@Target(METHOD) 
@Retention(RUNTIME)
@Documented
public @interface Capitalized {
    CapitalizeType type() default Capitalize.FIRST;
    String message() default "{validator.capitalized}";
}

...
#in ValidatorMessages.properties
validator.capitalized=<tt class="literal">Capitalization is not {type}</tt></pre><p>&#22914;&#20320;&#25152;&#35265;{}&#31526;&#21495;&#26159;&#36882;&#24402;&#30340;&#12290;</p><p>&#20026;&#20102;&#23558;&#19968;&#20010;&#25551;&#36848;&#31526;&#36830;&#25509;&#21040;&#23427;&#30340;&#39564;&#35777;&#22120;&#23454;&#29616;&#65292;&#25105;&#20204;&#20351;&#29992;<tt class="literal">@ValidatorClass</tt>
      &#20803;&#27880;&#35299;&#12290;&#39564;&#35777;&#22120;&#31867;&#21442;&#25968;&#24517;&#39035;&#25351;&#23450;&#19968;&#20010;&#23454;&#29616;&#20102;<tt class="literal">Validator&lt;ConstraintAnnotation&gt;</tt>
      &#30340;&#31867;&#12290;</p><p>&#25105;&#20204;&#29616;&#22312;&#35201;&#23454;&#29616;&#39564;&#35777;&#22120;(&#20063;&#23601;&#26159;&#23454;&#29616;&#35268;&#21017;&#26816;&#26597;)&#12290;&#19968;&#20010;&#39564;&#35777;&#22120;&#23454;&#29616;&#33021;&#26816;&#26597;&#19968;&#20010;&#23646;&#24615;&#30340;&#20540;
      (&#23454;&#29616;<tt class="literal">PropertyConstraint</tt>)&#65292;&#24182;&#19988;/&#25110;&#32773;&#21487;&#20197;&#20462;&#25913;hibernate&#26144;&#23556;&#20803;&#25968;&#25454;
      (&#23454;&#29616;<tt class="literal">PersistentClassConstraint</tt>)&#65292;&#31821;&#27492;&#34920;&#31034;&#25968;&#25454;&#24211;&#32423;&#30340;&#32422;&#26463;&#12290;</p><pre class="programlisting">public class CapitalizedValidator 
        implements Validator&lt;Capitalized&gt;, PropertyConstraint {
    private CapitalizeType type;

    //part of the Validator&lt;Annotation&gt; contract, 
    //allows to get and use the annotation values
    public void initialize(Capitalized parameters) {
        type = parameters.type();
    }

    //part of the property constraint contract
    public boolean isValid(Object value) {
        if (value==null) return true;
        if ( !(value instanceof String) ) return false;
        String string = (String) value;
        if (type == CapitalizeType.ALL) {
            return string.equals( string.toUpperCase() );
        }
        else {
            String first = string.substring(0,1);
            return first.equals( first.toUpperCase();
        }
    }
}</pre><p>&#22914;&#26524;&#36829;&#21453;&#32422;&#26463;&#65292;<tt class="literal">isValid()</tt>&#26041;&#27861;&#23558;&#36820;&#22238;false&#12290;&#26356;&#22810;&#20363;&#23376;&#35831;&#21442;&#32771;&#20869;&#24314;&#39564;&#35777;&#22120;&#23454;&#29616;&#12290;</p><p>&#33267;&#27492;&#25105;&#20204;&#21482;&#30475;&#21040;&#23646;&#24615;&#32423;&#30340;&#39564;&#35777;&#65292;&#20320;&#36824;&#21487;&#20197;&#20889;&#19968;&#20010;Bean&#32423;&#21035;&#30340;&#39564;&#35777;&#27880;&#35299;&#12290;Bean&#33258;&#36523;&#20250;&#34987;&#20256;&#36882;&#32473;&#39564;&#35777;&#22120;&#65292;
      &#32780;&#19981;&#26159;bean&#30340;&#23646;&#24615;&#23454;&#20363;&#12290;&#21482;&#35201;&#23545;bean&#33258;&#36523;&#36827;&#34892;&#27880;&#35299;&#21363;&#21487;&#28608;&#27963;&#39564;&#35777;&#26816;&#26597;&#12290;&#22312;&#21333;&#20803;&#27979;&#35797;&#22871;&#20214;&#20013;&#36824;&#21487;&#20197;&#25214;&#21040;&#19968;&#20010;&#23567;&#20363;&#23376;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3262"></a>4.1.5.&nbsp;&#27880;&#35299;&#20320;&#30340;&#39046;&#22495;&#27169;&#22411;</h3></div></div><div></div></div><p>&#26082;&#28982;&#20320;&#29616;&#22312;&#24050;&#32463;&#29087;&#24713;&#27880;&#35299;&#20102;&#65292;&#37027;&#20040;&#23545;&#35821;&#27861;&#20063;&#24212;&#35813;&#24456;&#28165;&#26970;&#20102;&#12290;</p><pre class="programlisting">public class Address {
    private String line1;
    private String line2;
    private String zip;
    private String state;
    private String country;
    private long id;
    
    // a not null string of 20 characters maximum
    @Length(max=20) 
    @NotNull
    public String getCountry() {
        return country;
    }
    
    // a non null string
    @NotNull
    public String getLine1() {
        return line1;
    }

    //no constraint    
    public String getLine2() {
        return line2;
    }
    
    // a not null string of 3 characters maximum
    @Length(max=3) @NotNull
    public String getState() {
        return state;
    }

    // a not null numeric string of 5 characters maximum
    // if the string is longer, the message will 
    //be searched in the resource bundle at key 'long'
    @Length(max=5, message="{long}")
    @Pattern(regex="[0-9]+")
    @NotNull
    public String getZip() {
        return zip;
    }
    
    // should always be true
    @AssertTrue
    public boolean isValid() {
        return true;
    }

    // a numeric between 1 and 2000
    @Id @Min(1)
    @Range(max=2000)
    public long getId() {
        return id;
    }
}</pre><p>&#19978;&#38754;&#30340;&#20363;&#23376;&#21482;&#23637;&#31034;&#20102;&#20844;&#20849;&#23646;&#24615;&#39564;&#35777;&#65292;&#20320;&#36824;&#21487;&#20197;&#23545;&#20219;&#20309;&#21487;&#35265;&#24230;&#30340;&#23383;&#27573;(field)&#36827;&#34892;&#27880;&#35299;&#12290;</p><pre class="programlisting">@MyBeanConstraint(max=45)
public class Dog {
    @AssertTrue private boolean isMale;
    @NotNull protected String getName() { ... };
    ...
}</pre><p>&#20320;&#21487;&#20197;&#23545;&#25509;&#21475;&#36827;&#34892;&#27880;&#35299;&#12290;Hibernate&#39564;&#35777;&#22120;&#20250;&#26816;&#26597;&#32473;&#23450;bean&#25152;&#25193;&#23637;&#25110;&#23454;&#29616;&#30340;&#25152;&#26377;&#29238;&#31867;&#21644;&#25509;&#21475;&#65292;
      &#31821;&#20197;&#35835;&#21462;&#30456;&#24212;&#30340;&#39564;&#35777;&#22120;&#27880;&#35299;(&#20449;&#24687;)&#12290;</p><pre class="programlisting">public interface Named {
    @NotNull String getName();
    ...
}

public class Dog implements Named {

    @AssertTrue private boolean isMale;

    public String getName() { ... };

}</pre><p>&#22312;&#39564;&#35777;Dog bean&#26102;&#20250;&#26816;&#26597;name&#23646;&#24615;&#30340;&#26377;&#25928;&#24615;(&#19981;&#20026;null)&#12290;</p></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3279"></a>4.2.&nbsp;&#20351;&#29992;&#39564;&#35777;&#22120;&#26694;&#26550;</h2></div></div><div></div></div><p>Hibernate&#39564;&#35777;&#22120;&#26088;&#22312;&#23454;&#29616;&#22810;&#23618;&#25968;&#25454;&#39564;&#35777;&#65292;&#25105;&#20204;&#22312;&#19968;&#22788;&#34920;&#31034;&#32422;&#26463;(&#24102;&#27880;&#35299;&#30340;&#22495;&#27169;&#22411;)&#65292;&#28982;&#21518;&#23558;&#20854;&#36816;&#29992;&#20110;
    &#24212;&#29992;&#31243;&#24207;&#30340;&#19981;&#21516;&#23618;&#12290;</p><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3284"></a>4.2.1.&nbsp;&#25968;&#25454;&#24211;schema&#23618;&#27425;&#39564;&#35777;</h3></div></div><div></div></div><p>&#26080;&#39035;&#39069;&#22806;&#25163;&#32493;&#65292;Hibernate Annotations&#20250;&#33258;&#21160;&#23558;&#20320;&#20026;&#23454;&#20307;&#23450;&#20041;&#30340;&#32422;&#26463;&#32763;&#35793;&#20026;&#26144;&#23556;&#20803;&#25968;&#25454;&#12290;&#20363;&#22914;&#65292;&#22914;&#26524;&#20320;&#30340;&#23454;&#20307;
      &#30340;&#19968;&#20010;&#23646;&#24615;&#27880;&#35299;&#20026;<tt class="literal">@NotNull</tt>&#65292;&#22312;Hibernate&#29983;&#25104;&#30340;DDL schema&#20013;&#36825;&#21015;&#20250;&#34987;&#23450;&#20041;&#20026;
      <tt class="literal">not null</tt>&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3295"></a>4.2.2.&nbsp;Hibernate&#22522;&#20110;&#20107;&#20214;&#30340;&#39564;&#35777;</h3></div></div><div></div></div><p>Hibernate&#39564;&#35777;&#22120;&#26377;&#20004;&#20010;&#20869;&#24314;Hibernate&#20107;&#20214;&#30417;&#21548;&#22120;&#12290;&#24403;&#19968;&#20010;<tt class="literal">PreInsertEvent</tt>
      &#25110;<tt class="literal">PreUpdateEvent</tt>&#21457;&#29983;&#26102;&#65292;&#30417;&#21548;&#22120;&#20250;&#39564;&#35777;&#35813;&#23454;&#20307;&#23454;&#20363;&#30340;&#25152;&#26377;&#32422;&#26463;&#65292;&#22914;&#26377;&#36829;&#21453;&#20250;&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;&#12290;
      &#22522;&#26412;&#19978;&#65292;&#22312;Hibernate&#25191;&#34892;&#20219;&#20309;&#25554;&#20837;&#21644;&#26356;&#26032;&#21069;&#23545;&#35937;&#20250;&#34987;&#26816;&#26597;&#12290;&#36825;&#26159;&#28608;&#27963;&#39564;&#35777;&#36807;&#31243;&#30340;&#26368;&#20415;&#25463;&#26368;&#31616;&#21333;&#30340;&#26041;&#27861;&#12290;&#24403;&#36935;&#21040;&#32422;&#26463;
      &#36829;&#35268;&#26102;&#65292;&#20107;&#20214;&#20250;&#24341;&#21457;&#19968;&#20010;&#36816;&#34892;&#26102;<tt class="classname">InvalidStateException</tt>&#65292;&#35813;&#24322;&#24120;&#21253;&#21547;&#19968;&#20010;&#25551;&#36848;&#27599;&#20010;&#38169;&#35823;&#30340;
      <tt class="literal">InvalidValue</tt>&#25968;&#32452;&#12290;</p><pre class="programlisting">&lt;hibernate-configuration&gt;
    ...
    &lt;event type="pre-update"&gt;
        &lt;listener 
          class="org.hibernate.validator.event.ValidatePreUpdateEventListener"/&gt;
    &lt;/event&gt;
    &lt;event type="pre-insert"&gt;
        &lt;listener 
          class="org.hibernate.validator.event.ValidatePreInsertEventListener"/&gt;
    &lt;/event&gt;
&lt;/hibernate-configuration&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">&#27880;&#24847;</h3><p>&#22312;&#20351;&#29992;Hibernate Entity Manager&#26102;&#65292;Validation&#26694;&#26550;&#20250;&#34987;&#33258;&#21160;&#28608;&#27963;&#12290;&#22914;&#26524;bean&#19981;&#24102;&#39564;&#35777;&#27880;&#35299;&#65292;
          &#23601;&#19981;&#20250;&#26377;&#24615;&#33021;&#25439;&#22833;&#12290;</p></div></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3318"></a>4.2.3.&nbsp;&#31243;&#24207;&#32423;&#39564;&#35777;</h3></div></div><div></div></div><p>Hibernate&#39564;&#35777;&#22120;&#33021;&#24212;&#29992;&#20110;&#20320;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#20013;&#30340;&#20219;&#20309;&#22320;&#26041;&#12290;</p><pre class="programlisting">ClassValidator personValidator = new ClassValidator( Person.class );
ClassValidator addressValidator = new ClassValidator( Address.class, ResourceBundle.getBundle("messages", Locale.ENGLISH) );

InvalidValue[] validationMessages = addressValidator.getInvalidValues(address);</pre><p>&#22836;&#20004;&#34892;&#20026;&#25191;&#34892;&#31867;&#26816;&#26597;&#32780;&#20934;&#22791;Hibernate&#39564;&#35777;&#22120;&#12290;&#31532;&#19968;&#34892;&#20381;&#36182;&#20110;&#23884;&#20837;&#22312;Hibernate&#39564;&#35777;&#22120;&#20869;&#30340;&#38169;&#35823;
      &#28040;&#24687;(&#35265;<a href="validator.html#validator-constraints-error">Error messages</a>)&#65292;&#31532;&#20108;&#34892;&#20026;&#36825;&#20123;&#28040;&#24687;&#20934;&#22791;&#36164;&#28304;&#21253;&#12290;&#36825;&#20123;&#20195;&#30721;&#21482;&#25191;&#34892;&#19968;&#27425;&#65292;
      &#24182;&#23558;&#39564;&#35777;&#22120;&#36827;&#34892;&#32531;&#23384;&#22788;&#29702;&#65292;&#36825;&#31181;&#26041;&#24335;&#26159;&#19968;&#31181;&#33391;&#22909;&#23454;&#36341;&#12290;</p><p>&#31532;&#19977;&#34892;&#30495;&#27491;&#39564;&#35777;&#20102;<tt class="literal">Address</tt>&#23454;&#20363;&#24182;&#36820;&#22238;&#19968;&#20010;<tt class="literal">InvalidValue</tt>&#25968;&#32452;&#12290;
      &#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#36923;&#36753;&#38543;&#21518;&#21487;&#20197;&#23545;&#38169;&#35823;&#20570;&#20986;&#21709;&#24212;&#12290;</p><p>&#38500;&#20102;&#38024;&#23545;&#25972;&#20010;bean&#20320;&#36824;&#21487;&#20197;&#23545;&#26576;&#20010;&#29305;&#23450;&#23646;&#24615;&#36827;&#34892;&#26816;&#26597;&#12290;&#36825;&#23545;&#20110;&#19968;&#20010;&#23646;&#24615;&#19968;&#20010;&#23646;&#24615;&#30340;&#29992;&#25143;&#20132;&#20114;&#24773;&#24418;&#25110;&#35768;&#26159;&#26377;&#29992;&#30340;&#12290;</p><pre class="programlisting">ClassValidator addressValidator = new ClassValidator( Address.class, ResourceBundle.getBundle("messages", Locale.ENGLISH) );

//only get city property invalid values
InvalidValue[] validationMessages = addressValidator.getInvalidValues(address, "city");

//only get potential city property invalid values
InvalidValue[] validationMessages = addressValidator.getPotentialInvalidValues("city", "Paris")</pre></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3341"></a>4.2.4.&nbsp;&#39564;&#35777;&#20449;&#24687;</h3></div></div><div></div></div><p>&#20316;&#20026;&#19968;&#20010;&#39564;&#35777;&#20449;&#24687;&#30340;&#36733;&#20307;&#65292;hibernate&#25552;&#20379;&#20102;&#19968;&#20010;<tt class="classname">InvalidValue</tt>&#25968;&#32452;&#12290;
      &#27599;&#20010;<tt class="literal">InvalidValue</tt>&#26377;&#19968;&#32452;&#65292;&#36825;&#20123;&#26041;&#27861;&#20998;&#21035;&#25551;&#36848;&#30456;&#24212;&#30340;&#20010;&#20307;&#38382;&#39064;&#12290;</p><p><tt class="methodname">getBeanClass()</tt>&#33719;&#21462;&#22833;&#36133;&#30340;bean&#31867;&#22411;&#12290;</p><p><tt class="methodname">getBean()</tt>&#33719;&#21462;&#39564;&#35777;&#22833;&#36133;&#30340;&#23454;&#20363;(&#22914;&#26524;&#26377;&#30340;&#35805;&#65292;&#24403;&#20351;&#29992;
      <tt class="methodname">getPotentianInvalidValues()</tt>&#26102;&#21017;&#19981;&#20250;&#21462;&#21040;) </p><p><tt class="methodname">getValue()</tt>&#33719;&#21462;&#39564;&#35777;&#22833;&#36133;&#30340;&#20540;</p><p><tt class="methodname">getMessage()</tt>&#33719;&#21462;&#21512;&#36866;&#30340;&#22269;&#38469;&#21270;&#38169;&#35823;&#28040;&#24687;</p><p><tt class="methodname">getRootBean()</tt>&#33719;&#21462;&#20135;&#29983;&#38382;&#39064;&#30340;&#26681;bean&#23454;&#20363;(&#22312;&#19982;<tt class="literal">@Valid</tt>&#36830;&#29992;
      &#26102;&#24456;&#26377;&#29992;)&#65292;&#22914;&#29992;getPotentianInvalidValues()&#21017;&#36820;&#22238;null&#12290;</p><p><tt class="literal">getPropertyPath()</tt>&#33719;&#21462;&#8220;&#38382;&#39064;&#8221;&#23646;&#24615;&#20174;&#26681;bean&#24320;&#22987;&#30340;&#24102;&#28857;&#30340;&#36335;&#24452;</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="xml-overriding.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="lucene.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;3&nbsp;&#31456;&nbsp;&#36890;&#36807;XML&#35206;&#20889;&#20803;&#25968;&#25454;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;5&nbsp;&#31456;&nbsp;Hibernate&#19982;Lucene&#38598;&#25104;</td></tr></table></div></body></html>